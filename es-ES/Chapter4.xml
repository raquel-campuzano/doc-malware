<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "manual.ent">
<!ENTITY PRODUCT "Documentation">
<!ENTITY BOOKID "manual">
<!ENTITY YEAR "2014">
<!ENTITY HOLDER "Eneo Tecnología S.L. |">
]>
<chapter>
	<title>Sensores IPS/IDS</title>
	<para>La configuración y registro de los sensores IPS/IDS en el Manager es un paso posterior a la instalación del mismo. Este proceso consta fundamentalmente de cuatro pasos:</para>
	<itemizedlist mark="bullet">
		<listitem>
			<para>Instalación y registro de los sensores IDS en el Manager</para>							
		</listitem>	
		<listitem>
			<para>Configuración de parámetros basicos de los sensores IDS en la plataforma redBorder</para>
		</listitem>
		<listitem>
			<para>Actualización de políticas, fuentes de reglas y activación de reglas por sensor desde la plataforma redBorder</para>
		</listitem>
		<listitem>
			<para>Procedimiento de actualización de Snort</para>
		</listitem>
	</itemizedlist>
	<para>Al poner en funcionamiento el asistente de instalación, visualizaremos el menú principal en el que encontrará la opción <literal>Install Sensor IPS</literal>:</para>
	<mediaobject>
		<imageobject>
			<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img000.png"/>
		</imageobject>
		<caption>
			<para>Asistente de instalación redBorder: Instalar sensor IPS</para>
		</caption>
	</mediaobject>
	<para>A continuación el usuario deberá introducir su nombre de usuario y contraseña <footnote><para>El nombre de usuario y contraseña que se deben introducir en este paso corresponden con los que se han indicado en el proceso de instalación del Manager ys erán los que le sirvan para acceder a la plataforma web redBorder.</para></footnote>, así como ejecutar el comando rb_sysconf:</para>
    <itemizedlist mark="bullet">
		<listitem>
			<para>Login</para>
		</listitem>
		<listitem>
			<para>Password</para>
		</listitem>
		<listitem>
			<para>Comando rb_sysconf</para>
		</listitem>
	</itemizedlist>	
	<note>
		<title>Nota</title>
		<para>Para realizar la instalación del Manager es necesario registrarse con el usuario que tiene mayores permisos: <emphasis>root.</emphasis></para>
	</note>	
	<para>Este proceso es idéntico al expuesto en la <emphasis role="bold">Finalización del proceso de instalación del asistente para la configuración del Manager.</emphasis></para>
	<mediaobject>
		<imageobject>
			<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img001.png"/>
	    </imageobject>
		<caption>
			<para>Login</para>
		</caption>
	</mediaobject>
	<mediaobject>
		<imageobject>
			<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img002.png"/>
	    </imageobject>
	    <textobject>
			<phrase>rb_sysconf: lanzar el menú de configuración de los sensores IPS</phrase>
		</textobject>
		<caption>
			<para>rb_sysconf: lanzar el menú de configuración de los sensores IPS</para>
		</caption>
	</mediaobject>
	<section>
		<title>Menú de configuración de los sensores IPS</title>
		<para>Una vez ha ejecutado el comando <literal>rb_sysconf</literal> accederá al <emphasis role="bold"> Menú de Configuración redBorder.</emphasis></para>
		<para>Este menú consta de 5 opciones:</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para><literal>System Configuration:</literal>desde esta opción se pueden definir y modificar una serie de ajustes básicos del sistema como el nombre, hora, tipo de teclado, etc.</para>
			</listitem>
			<listitem>
				<para><literal>Network Configuration:</literal> esta es la opción desde la cual se realizan todas las configuraciones de red para la correcta implantación de la solución.</para>
			</listitem>
			<listitem>
				<para><literal>Passwords:</literal> acceda a esta opción si desea modificar sus contraseñas.</para>
			</listitem>
			<listitem>
				<para><literal>Backup System:</literal> permite realizar una copia de seguridad de la configuración.</para>
			</listitem>
			<listitem>
				<para><literal>Update rules from Manager:</literal> seleccione esta opción para forzar la descarga de las reglas del Manager (opcional).</para>
			</listitem>
			<listitem>
				<para><literal>quit:</literal> Salir.</para>
			</listitem>
		</orderedlist>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img003.png"/>
			</imageobject>
			<textobject>
				<phrase>Menú de configuración de los sensores IPS</phrase>
			</textobject>
			<caption>
				<para>Menú de configuración de los sensores IPS</para>
			</caption>
		</mediaobject>
	</section>
	<section>
		<title>Configuración de red de los sensores IPS</title>
		<para>Para que los sensores puedan comunicarse con el Manager es necesario realizar la configuración de red de los mismos. Seleccionar la opción <literal>2) Network Configuration</literal> del menú de Configuración redBorder.</para>
		<para>Hasta que no se haya realizado esta configuración, no se podrá proceder al registro de los sensores en el Manager.</para>
		<para>Estos son los pasos que hay que seguir para realizar la instalación de los sensores IPS:</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para>Configuración de la red de gestión:</para>
				<para>a) Creación del bonding y asignación de interfaz de gestión.</para>
				<para>b) Configuración de los segmentos o interfaces de red en los que van a colocarse los sensores.</para>	
			</listitem>
			<listitem>
				<para>Configuración DNS y dominio</para>
			</listitem>
		</orderedlist>
		<note>
			<title>Nota</title>
			<para>El orden que se siga en los pasos que comprenden la configuración de la red de gestión es indiferente. El orden indicado en este manual de instalación es el que se considera más óptimo.</para>
		</note>
		<warning>
			<title>Advertencia</title>
			<para>En caso de que el sistema se instale en un equipo real que disponga de más de una tarjeta de red, el usuario deberá elegir cuál será el bonding de gestión.</para>
		</warning>
	</section>
	<section>
		<title>Management Network Configuration: creación del bonding y asignación de la interfaz de gestión</title>
		<para>Seleccione la opción <literal>Network Configuration</literal> insertando la opción <keycap>2</keycap> y pulsando <keycap>Enter.</keycap></para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img004.png"/>
			</imageobject>
		<caption>
			<para>Asignación automática de segmentos con bypass</para>
		</caption>
		</mediaobject>
		<para>En caso de que el sistema reconozca interfaces con <emphasis>bypass</emphasis> estas serán asignadas automáticamente a los segmentos.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img005.png"/>
			</imageobject>
			<caption>
				<para>Proceso de puesta en red de los sensores</para>
			</caption>
		</mediaobject>
		<para>A continuación se realizarán las siguientes acciones para asegurarnos que la red de los sensores queda correctamete configurada:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Creación de un bonding: (máximo 4 bonds).</para>
			</listitem>
			<listitem>
				<para>Selección y asignación de puertos al bonding.</para>
			</listitem>
			<listitem>
				<para>Configuración de la interfaz de gestión para los bondings creados.</para>
			</listitem>
		</itemizedlist>
		<para>Para la selección de puertos, se visualizará un listado con información muy valiosa y detallada, que ayudará al administrador a decidir qué puertos se encuentran disponibles para la creación del bonding.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img006.png"/>
			</imageobject>
			<textobject>
				<phrase>Insertar puerto para el bonding</phrase>
			</textobject>
			<caption>
				<para>Insertar puerto para el bonding</para>
			</caption>
		</mediaobject>
		<note>
			<title>Nota</title>
			<para>Selección de opciones predeterminadas: <keycap>Enter</keycap></para>
		</note>
		<section>
			<title>Creación de un nuevo bonding y asignación de puertos</title>
			<para>Para ilustrar este proceso crearemos un bonding (bond0) y le asignaremos 2 puertos.</para>
			<para>Seleccione la opción <keycap>n</keycap> que aparece en el submenú lateral derecho de la pantalla.</para>
			<para>Una vez que haya revisado los puertos que se encuentran disponibles, seleccione aquel que desea asignar al bonding, tal y como aparece en el margen inferior de la pantalla anterior.</para>
			<para>Introduzca el número de puerto en la línea <literal>Insert bonding first port [0]:</literal></para>
			<para>El número que aparece entre corchetes <literal>[]</literal> es el que define el sistema por defecto. Para seleccionar este número, pulse <keycap>Enter.</keycap></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img007.png"/>
				</imageobject>
				<textobject>
					<phrase>Creación de bonding: asignación de puertos</phrase>
				</textobject>
				<caption>
					<para>Creación de bonding: asignación de puertos</para>
				</caption>
			</mediaobject>
			<para>El puerto seleccionado desaparecerá de la opción de puertos disponibles.</para>
			<important>
				<title>Importante</title>
				<para>El sistema solo permite la creación de un máximo de 4 bonds: (0-3).</para>
			</important>
		</section>
		<section>
			<title>Añadir un nuevo puerto al bonding</title>
			<para>El sistema le hará la siguiente pregunta: <literal>Insert second port (y/N)</literal></para>
			<para>La opción que viene predeterminada por defecto aparece en mayúscula. Recuerde que si NO desea añadir un nuevo puerto tan solo tiene que pulsar la tecla <keycap>Enter</keycap>.</para>
			<para>En caso de que desee insertar un nuevo puerto, teclee <keycap>y</keycap>.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img008.png"/>
				</imageobject>
			<textobject>
				<phrase>Añadir nuevo puerto al bonding</phrase>
			</textobject>
			<caption>
				<para>Añadir nuevo puerto al bonding</para>
			</caption>
			</mediaobject>
			<para>Introduzca el número de puerto en la línea <literal>Insert bonding second port [1]:</literal></para>
			<para>El número que aparece entre corchetes <literal>[]</literal> es el que define el sistema por defecto. Para seleccionar este número, pulse <keycap>Enter</keycap>.</para>			
		</section>
		<section>
			<title>Configuración de la red del bonding</title>
			<para>Una vez que ha realizado la asignación del segundo puerto al nuevo bond (bond0), el sistema le pedirá que introduzca los siguientes datos:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para>Dirección IP</para>
				</listitem>
				<listitem>
					<para>Máscara de red</para>
				</listitem>
				<listitem>
					<para>Pasarela</para>
				</listitem>
				<listitem>
					<para>Rutas</para>
				</listitem>
			</itemizedlist>
			<para>Si su equipo utiliza protocolo DHCP, le será asignada una dirección IP por defecto. Pulsar <keycap>Enter</keycap> para seleccionar la IP, máscara y pasarela asignadas por el sistema.  En caso contrario, introduzca manualmente estos valores.</para>
			<para>El sistema también le otorga una ruta por defecto para el bonding creado.</para>
			<para>Para insertar una ruta manualmente, seleccione la opción <keycap>y</keycap> en la línea <literal>Insert a route for this bonding (y/N)?:</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img009.png"/>
				</imageobject>
				<caption>
				<para>Añadir manualmente una ruta al bonding</para>
			</caption>
			</mediaobject>
			<para>Una vez que haya terminado con este proceso, visualizará un mensaje avisándole de que el Bonding se ha creado con éxito: <literal>Bonding 0 created successfully.</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img010.png"/>
				</imageobject>
			</mediaobject>
		</section>
		<section>
			<title>Finalizar el proceso de creación del bonding</title>
			<para>Antes de aplicar cambios y finalizar el proceso de creación del bonding el sistema le mostrará una tabla en la que figuran el nuevo bonding creado (bond0) junto con los puertos que le han sido asignados, la IP y Máscara y la ruta asignadas.</para>	
			<para><emphasis role="bold">Aplicar cambios</emphasis></para>
			<para>Para que las modificaciones realizadas queden guardadas, debe realizar la acción de aplicar cambios, seleccionando la opción <keycap>a.</keycap></para>
			<para>Puede borrar en cualquier momento el/ los bonds creados seleccionado la opción <literal>delete bonding</literal> insertando la letra <keycap>d.</keycap></para>
			<para>Para volver al menú principal de configuración de red, seleccionar la opción <literal>quit</literal> con la letra <keycap>q.</keycap></para>
		</section>
	</section>
	<section>
		<title>Configuración DNS y dominio</title>
		<para>En el menú de configuración de red encontramos la opción de <literal>DNS and domain settings.</literal> Para comenzar el proceso, seleccionar la opción <keycap>2.</keycap></para>
		<para>Para realizar la configuración correctamente, el usuario deberá introducir:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Nombre de Dominio</para>
			</listitem>
			<listitem>
				<para>Dirección DNS primaria</para>
			</listitem>
			<listitem>
				<para>Dirección DNS secundaria (opcional)</para>
			</listitem>
		</itemizedlist>
		<para>Una vez introducida esta información, el sistema avisará de que se ha aplicado esta configuración de manera correcta.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img011.png"/>
			</imageobject>
		<caption>
			<para>Configuración DNS y dominio</para>
		</caption>
		</mediaobject>
		<para>Para finalizar el proceso, no es necesario aplicar cambios, seleccionar la opción <literal>quit</literal> insertando la letra <keycap>q</keycap> para volver al menú principal de configuración de red.</para>
	</section>
	<section>
		<title>Configuración de los segmentos de red</title>
		<para>Seleccionar en el Menú de Configuración de Red la opción <literal>Segment settings</literal> ingresando el número <keycap>3</keycap>.</para>
		<para>En esta pantalla se muestran el número de segmentos que se han creado, los puertos asignados a cada segmento y si estos disponen o no de soporte por bypass.</para>
		<para>En ella encontrará el siguiente submenú:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para><keycap>f)</keycap> <literal>force bypass autoassign:</literal>forzar la asignación automática de puertos con bypass.</para>
			</listitem>
			<listitem>
				<para><keycap>n)</keycap> <literal>new segment:</literal>seleccionar para crear un nuevo segmento.</para>
			</listitem>
			<listitem>
				<para><keycap>d)</keycap> <literal>delete segment:</literal>borrar un segmento.</para>
			</listitem>
			<listitem>
				<para><keycap>q)</keycap> <literal>quit:</literal>salir.</para>
			</listitem>
		</itemizedlist>
		<para>Para comenzar la creación del segmento seleccione la opción <literal>n) new segment.</literal></para>
		<para>El proceso de creación de los segmentos comprende las siguentes acciones:</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para>Asignación de interfaces de tipo bypass a los segmentos (opcional).</para>
			</listitem>
			<listitem>
				<para>Creación de un segmento: (máximo 16 segmentos).</para>
			</listitem>
			<listitem>
				<para>Selección y asignación de puertos al segmento.</para>
			</listitem>
		</orderedlist>
		<para> Para la selección de puertos, se visualizará un listado con información muy valiosa y detallada, que ayudará al administrador a decidir en qué puertos estarán los segmentos creados.</para>
		<section>
			<title>Asignación de interfaces con bypass a los segmentos</title>
			<para>Si el sistema detecta interfaces de tipo bypass, estas se asignan automáticamente a los segmentos cuando se ingresa en el menú de configuración de red.</para>
			<para>Existen, además, otras dos modalidades de asignación de puertos o interfaces con bypass a segmentos:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><emphasis role="bold"> Forzar autoasignación de bypass:</emphasis> seleccionar la opción <literal>Force bypass auto assign</literal> en el menú de configuración de los segmentos, introduciendo la letra <keycap>f.</keycap></para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Asignación manual:</emphasis> seleccionando los puertos con bypass del listado de puertos disponibles que se visualizará en el proceso de creación de los segmentos.</para>				
				</listitem>
			</itemizedlist>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img012.png"/>
				</imageobject>
			<caption>
				<para>Asignar puertos al segmento</para>
		    </caption>
			</mediaobject>
		</section>
		<section>
			<title>Creación de un nuevo segmento y asignación de puertos</title>
			<para>Para ilustrar este proceso crearemos un segmento (segment 0) y le asignaremos 2 puertos.</para>
			<para> Para comenzar con el proceso de creación del segmento, seleccione la opción <keycap>n</keycap> que aparece en el submenú lateral derecho de la pantalla.</para>
			<para>Una vez que haya revisado los puertos que se encuentran disponibles, seleccione aquel al que desea asignar al segmento tal y como aparece en el margen inferior de la pantalla anterior.</para>
			<para>Introduzca el número que le va a dar al segmento en la línea <literal>Insert segment number (0-15) [0]:</literal></para>
			<para>El número que aparece entre corchetes <literal>[]</literal> es el que define el sistema por defecto. Para seleccionar este número, pulse <keycap>Enter</keycap>.</para>
		    <para>El puerto asignado anteriormente al segmento desaparecerá del listado de puertos disponibles.</para>
		    <note>
				<title>Nota</title>
				<para>El sistema solo permite la creación de un máximo de 16 segmentos (0-15).</para>
		    </note>
		</section>
		<section>
			<title>Añadir un segundo puerto al segmento</title>
			<para>Una vez que haya asignado el primer puerto al segmento, el sistema le planteará la posibilidad de asignar un segundo puerto al segmento: <literal>Assign second port to the segment (Y/n):</literal></para>
			<para>La opción que viene predeterminada por defecto aparece en mayúscula.</para>
			<para>Recuerde que si desea asignar un nuevo puerto tan solo tiene que pulsar la tecla <keycap>Enter.</keycap></para>
			<para>En caso de que no desee asignar un nuevo puerto, teclee <keycap>n</keycap>. Una vez que haya revisado los puertos que se encuentran disponibles, seleccione aquel que desea asignar al segmento tal y como aparece en el margen inferior de la pantalla anterior.</para>
			<para>Introduzca el número de puerto en la línea <literal>Insert segment second port [3]:</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img013.png"/>
				</imageobject>
			<caption>
				<para>Asignar un nuevo puerto al segmento</para>
			</caption>
		    </mediaobject>
			<para>Una vez que se han asignado los dos puertos a un segmento, el sistema le avisará de que el segmento ha sido creado correctamente: <literal>Segment 0 created successfully.</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img014.png"/>
				</imageobject>
			<caption>
				<para>Confirmación de creación de segmento</para>
			</caption>
			</mediaobject>
		</section>
		<section>
			<title>Finalizar el proceso de creación de los segmentos</title>
			<para>Antes de aplicar cambios y finalizar el proceso de creación del segmento, visualizará una pantalla con un listado que incluye los siguientes elementos:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para>Segmentos</para>
				</listitem>
				<listitem>
					<para>Puertos asignados al segmento</para>
				</listitem>
				<listitem>
					<para>Si dispone o no de interfaces bypass</para>
				</listitem>
			</itemizedlist>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img015.png"/>
				</imageobject>
			<caption>
				<para>Resumen de segmentos y puertos asignados</para>
			</caption>
			</mediaobject>		
			<para><emphasis role="bold">Aplicar cambios</emphasis></para>
			<para>Para que las modificaciones realizadas queden guardadas, debe realizar la acción de aplicar cambios, seleccionando la opción <keycap>a.</keycap></para>
			<para>Puede borrar en cualquier momento los segementos creados seleccionado la opción <literal>delete segment</literal>, insertando la letra <keycap>d.</keycap></para>
			<para>Para volver al menú principal de configuración de red, seleccionar la opción <literal>quit</literal> con la letra <keycap>q.</keycap></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img017.png"/>
				</imageobject>
			<caption>
				<para>Resumen de segmentos y puertos con bypass</para>
			</caption>
			</mediaobject>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img019.png"/>
				</imageobject>
			<caption>
				<para>Aplicar cambios para la finalización de creación de segmentos</para>
			</caption>
			</mediaobject>		
		</section>
	</section>
	<section>
		<title>Equipos gestionados con IPMI</title>
		<para>En caso de que el usuario disponga de un equipo gestionado a través del sistema IPMI, tiene la posibilidad de insertar la IP correspondiente al IPMI de su equipo para que los sensores se conecten con él.</para>
		<para>Seleccionar en el Menú de Configuración de Red la opción <literal>4) IPMI Network configuration wizard.</literal></para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img021.png"/>
			</imageobject>
		<caption>
			<para>Equipos gestionados con IPMI</para>
		</caption>
		</mediaobject>	
		<para><emphasis role="bold">Aplicar cambios</emphasis></para>
		<para>Para finalizar el proceso de configuración de red  debe realizar la acción de aplicar cambios <literal>apply</literal>, seleccionando la opción <keycap>a.</keycap></para>
		<para>Puede consultar la configuración de la IPMI en cualquier momento seleccionando la opción <literal>info</literal> insertando la letra <keycap>i.</keycap></para>
		<para>Al aplicar cambios, el sistema terminará de realizar las configuraciones necesarias para comenzar el registro de los sensores.</para>	
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img020.png"/>
			</imageobject>
		<caption>
				<para>Finalización de la configuración de los sensores previa al registro en el Manager</para>
		</caption>
		</mediaobject>	
	</section>
	<section>
		<title>Registro de los sensores en el Manager</title>
		<para>Para finalizar el proceso de instalación de los sensores IPS, el último paso que debe llevarse a cabo es el <emphasis role="bold">Registro de los sensores en el Manager.</emphasis></para>
		<para>Hasta que no se haya completado el registro visualizará un mensaje en el que se indica que los sensores aún no han sido registrados en el Manager. </para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img022.png"/>
			</imageobject>
			<caption>
				<para>Inicio del regsitro de los sensores en el Manager</para>
			</caption>
	    </mediaobject>	
		<para>En el menú de registro de los sensores en el Manager encontramos las siguientes opciones:</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para><literal>Hostname [rbsensor]:</literal> asignar un nombre al sensor.</para>
			</listitem>
			<listitem>
				<para><literal>Set local time:</literal> configurar hora local.</para>
			</listitem>
			<listitem>
				<para><literal>IP adress for rB Master Manager [127.0.0.1]:</literal> introducir la IP del Manager.</para>
			</listitem>
			<listitem>
				<para><literal>Register rB:</literal> registro de los sensores en el manager Sensor/Manager. Hasta que no se haya completado el proceso de registro el usuario visualizará el siguiente mensaje rotulado en rojo: <literal>(not registered yet)</literal></para>
			</listitem>
		</orderedlist>
		<section>
			<title>Asignar nombre al sensor (Hostname)</title>
			<para> Seleccionar la opción <literal>Hostname [rbsensor]</literal> del menú de registro de los sensores en el Manager insertando el número <keycap>1.</keycap></para>
			<para> A continuación, en la línea <literal>Insert Hostname [rbsensor]:</literal> escribir el nombre que se desea dar al sensor que se va a registrar en el Manager. A partir de este momento, este es el nombre que visualizará en la web cuando acceda al listado de sensores IPS.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img023.png"/>
				</imageobject>
			<caption>
				<para>Asignar nombre al sensor</para>
			</caption>
			</mediaobject>
			<note>
				<title>Nota</title>
				<para>Recuerde introducir un nombre coherente para el sensor. Evite utilizar el nombre “Sensor”, ya que ese es el nombre genérico que utiliza el Manager y que a la larga, podría causar confusión.</para>
			</note>
			<warning>
				<title>Advertencia</title>
				<para>El sistema le pedirá que verifique que el nombre elegido es el correcto, en ese caso, pulse <keycap>Enter</keycap></para>
				<para>Si desea modificarlo inserte la letra <keycap>n</keycap></para>
				<para>El sistema procederá a cambiar el nombre del sensor. Para continuar, y regeresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
			</warning>	
		</section>		
		<section>
			<title>Configurar hora local</title>
			<para>Seleccionar la opción <literal>2) Set local time.</literal></para>
			<para>Insertar fecha y hora de la franja horaria correspondiente al país en el que se encuentre. Esta debería coincidir con la seleccionada en la fase de ajustes básicos durante el proceso de configuración de los sensores IPS. </para>
			<para> El sistema le indica dos formatos posibles para la inserción de la fecha y la hora:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><literal>[HH:mm]</literal> ó <literal>[YYYY/MM/DD]</literal></para>
				</listitem>
				<listitem>
					<para><literal> [YYYY/MM/DD HH:mm]</literal></para>
				</listitem>
			</itemizedlist>
			<para>Pulsar <keycap>Enter</keycap> para continuar con el proceso de registro.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img024.png"/>
			    </imageobject>
			   <caption>
				<para>Registro de los sensores en el Manager: Selección hora local</para>
			</caption>
		    </mediaobject>
		</section>
		<section>
			<title>Introducir la IP del Master Manager</title>
			<para>Seleccionar la opción <literal>3) IP adress for rB Master Manager [127.0.0.1].</literal></para>
			<para>Insertar la dirección IP o nombre de dominio del equipo utilizado por el usuario. El sistema realizará una serie de comprobaciones para verificar si es alcanzable. Este proceso puede llevar unos segundos.</para>
			<para>El sistema sincronizará la hora de los equipos y a continuación, reiniciará un par de servicios con el objetivo de finalizar la sincronía horaria.</para>
			<para> ¡Enhorabuena! Su equipo está preparado para realizar el registro de los sensores en el Manager.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img025.png"/>
			    </imageobject>
			   <caption>
				<para>Insertar IP master Manager</para>
			</caption>
		    </mediaobject>
		    <para>Para continuar, y regeresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
		</section>
		<section>
			<title>Registro de los sensores en el Manager</title>
			<para>Este es el último paso que da por finalizado el proceso de implantación de la solución redBorder IPS.</para>
			<para> A partir de este momento, usted podrá trabajar directamente desde la aplicación de gestión IPS, en cuyo dashboard visualizará de manera gráfica todos los eventos de tráfico captados por los sensores IPS. </para>
			<para>En esta aplicación podrá crear informes, visualizar los eventos o configurar las reglas del Manager entre otras acciones. </para>
			<para><emphasis>Finalización del proceso del registro de los sensores en el Manager</emphasis></para>
			<para> Los pasos que se van a seguir para completar el proceso de registro de los sensores en el Manager son los siguientes:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para> Indicar si se desea tener una salida de depuración: el sistema formulará la siguiente pregunta <literal>Would you like to have a debug output?</literal> Seleccionar la opción predeterminada (No) insertando la letra <keycap>N</keycap>.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Insertar password:</emphasis> indicar la clave que se ha introducido en la fase de ajustes básicos para la configuración del Manager.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold"> Sincronización temporal (automático) entre el Manager y los sensores:</emphasis> este proceso puede llevar unos segundos en completarse.</para>
		        </listitem>
		     </orderedlist>
		     <mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img026.png"/>
				</imageobject>
			<caption>
				<para>Finalización del registro de los sensores en el Manager</para>
			</caption>
			</mediaobject>
				<para>Tras la realización de estos pasos, el sistema le avisará con un mensaje de que el sensor ha sido registrado con éxito.</para>
				<para><literal> Sensor registered succesfully with chef server</literal></para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img028.png"/>
			        </imageobject>
			    <caption>
					<para>Registro del sensor en el servidor</para>
				</caption>
		    </mediaobject>
			<warning>
				<title>Advertencia</title>
				<para>No cambiar el nombre del sensor o <emphasis>hostname</emphasis> una vez que ha sido registrado. Si desea realizar cambios, será necesario deshacer todo el proceso de registro y comenzarlo de nuevo.</para>
			</warning>
			<para>Para continuar y regresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
			<para>En él menú de registro de los sensores en el Manager redBorder puede comprobar que el sensor ha sido registrado con éxito:<literal>(Registered).</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img029.png"/>
			    </imageobject>
			    <caption>
					<para>Registro del sensor realizado con éxito</para>
				</caption>
		    </mediaobject>
		    <para> Para salir del asistente de registro de los sensores en el Manager, seleccione la opción <literal>quit</literal> introduciendo la letra <keycap>q.</keycap></para>				
		</section>
	</section>
	<section>
		<title>Configuración de parámetros generales del sensor IPS</title>
		<para>En este apartado encontramos las opciones disponibles para configurar los sensores IPS en modo IDS (requerido para Malware) así como comportamiento de Snort y PF_RING.</para>
		<para>Para ello deberemos acceder a la plataforma web mediante la dirección IP que se haya seleccionado para el Manager:</para>
		<para><screen>https://direccion-IP-manager</screen></para>
		<note>
			<title>Nota</title>
			<para>Es posible iniciar sesión en la plataforma usando la cuenta definida por defecto: <emphasis role="bold">admin o admin@redborder.net</emphasis> y con la contraseña que haya insertado en el proceso de instalación del Manager.</para>
		</note>
		<warning>
			<title>Advertencia</title>
			<para>La web de gestión no funcionará si se intenta acceder a ella mediante web no cifrada.</para>
		</warning>
		<para>Para editar los parámetros generales del sensor IPS el usuario debe dirigirse a la sección <literal>Sensors</literal> situada en el lado derecho del menú de cabecera. A continuación deberá seleccionar el sensor que desea editar.</para>
		<para>En la vista árbol, los sensores IPS vienen acompañados de un icono identificativo. También puede buscar el sensor que desea editar en el listado que se muestra desde <literal>View>IPS Sensors.</literal></para>
		<para>Para comenzar la edición de los parámetros generales del sensor hacer clic en el icono "Editar":</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img030.png"/>
			</imageobject>
			<caption>
				<para>Campos editables para la configuración IPS/IDS</para>
			</caption>
		</mediaobject>
		<note>
			<title>Nota</title>
			<para>Las opciones disponibles en el apartado <literal>IPS/IDS Settings</literal> aplican a nivel de dominio y a nivel de sensor.</para>
		</note>
		<para>Las configuraciones que se van a realizar en esta interaz son las siguientes:</para>
		<itemizedlist mark="mark">
			<listitem>
				<para>Modo del sensor: IDS</para>
			</listitem>
			<listitem>
				<para>Configuración de segmentos</para>
			</listitem>
			<listitem>
				<para>Grupos de sensores</para>
			</listitem>
		</itemizedlist>
		<para><literal>Sensor mode</literal></para>
		<para>Modo predeterminado del sensor <literal>Default sensor mode: </literal> en esta casilla aparecerá el modo que se haya heredado del dominio o sensor del que depende el que estamos consultando. Cuando un modo ha sido heredado desde el inicio indica que ese modo ha sido heredado directamente del nivel superior.</para>
		<para>En este campo, el usuario podrá elegir entre 4 opciones diferentes:</para>		
		<orderedlist>
			<listitem>
				<para><emphasis role="bold">IDS forwarding:</emphasis> el tráfico es desviado de manera inmediata, a continuación, una copia del mismo es analizada. En la práctica, produce el mismo efecto que tener un TAP interpuesto antes del sensor.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">IDS span:</emphasis> únicamente se recibe tráfico. No se realiza ningún desvío.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">IPS test mode:</emphasis> el tráfico es analizado y posteriormente, desviado. </para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">IPS:</emphasis> esta es la opción más común en entornos de producción. Snort analiza el tráfico y deja pasar o bloquea el tráfico dependiendo de las acciones de la regla en la política activa del sensor.</para>
			</listitem>			
		</orderedlist>
		<important>
			<title>Importante</title>
			<para>El sensor debe estar configurado en <emphasis role="bold">modo IDS forwarding o IDS span</emphasis> para el escenario básico de la instalación de redBorder Malware.</para>
		</important>
		<para>A continuación, el usuario puede editar una serie de parámetros relacionados con el funcionamiento del sensor:</para>
		<para><literal>PF_RING Watermark</literal></para>
		<para>Indica el número mínimo de paquetes entrantes para la función poll.</para>
		<itemizedlist mark="bullet">	
			<listitem>		
				<para>Valor bajo de watermark (1): reduce la latencia de la función poll, disminuye el throughtput, pero puede incrementar el número de llamadas a la función poll.</para>
			</listitem>
			<listitem>	
				<para>Valor alto de watermark (nunca debe exceder del 50% del tamaño del anillo o de lo contrario el módulo kernel de PF_RING aumentará este valor): reduce el número de llamadas poll,
			pero aumenta ligeramente la latencia de paquete.</para>
			</listitem>
		 </itemizedlist>
		<para><literal>PF_RING Clustermode</literal></para>
		<para>Indica el número de parámetros usados para determinar el hash y el balanceo del tráfico entre los diferentes procesos Snort. Dependiendo del número de tuplas seleccionadas se incluirán más o menos datos de resumen del tráfico:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>2 tuple flow: IP de origen+IP de destino</para>
			</listitem>
			<listitem>
				<para>4 tuple flow: IP de origen:puerto+IP de destino:Puerto</para>
			</listitem>
			<listitem>
				<para>5 tuple flow: IP de origen:puerto+IP de destino:Puerto+protocolo</para>
			</listitem>
			<listitem>
				<para>6 tuple flow: IP de origen:puerto+IP de destino:Puerto+protocolo+Vlan</para>
			</listitem>
		</itemizedlist>
		<para><literal>Bypass controlled by Snort</literal></para>
		<para>Cuando la máquina arranca Snort puede tomar el control de los bypass automáticamente. Esta acción puede provocar un flapping indeseado del firewall para evitar que Snort esté habilitado para el control de los bypass.</para>
		<para><literal>Threshold Count</literal></para>
		<para>Número máximo de ocurrencias en un rango de tiempo determinado.</para>
		<para><literal>Threshold Seconds</literal></para>
		<para>Tiempo mínimo (en segundos) que tiene que pasar para enviar un evento.</para>
		<note>
			<title>Nota</title>
			<para>En escenarios donde existe una sobrecarga en el tráfico es posible realizar una configuración que permita mantener la conectividad por encima del análisis de los paquetes.</para>
			<para>Las opciones de <literal>Best effort Configuration</literal> y <literal>Software Bypass Configuration</literal> se utilizan para priorizar el reenvío de información sobre el análisis de la misma.</para>
		</note>
		<para><literal>Best effort Configuration</literal></para>
		<para>Esta configuración solo aplica en el modo <emphasis role="bold">IDS.</emphasis></para>
		<para>Al habilitar esta opción,el tráfico es copiado en una cola interna de trabajo y posteriormente, desviado. Solo en el caso de que no existan más paquetes que desviar, se procesarán los paquetes que se encuientran en la cola interna. 
		Si la cola interna se encontrase llena, los paquetes no serán analizados. Esto aumenta la fiabilidad del desvío, pero disminuye el rendimiento del análisis. </para>
		<para><literal>Software Bypass Configuration</literal></para>
		<para>Esta configuración solo aplica en el modo <emphasis role="bold">IPS.</emphasis></para>
		<para>La activación de esta opción implica que, si la ocupación del anillo de la interfaz es alta, el IPS desviará los paquetes sin analizar hasta que la ocupación se encuentre por debajo de otro valor predeterminado.</para>
		<important>
			<title>Importante</title>
			<para>La configuración del bypass de IPS se realiza a nivel de software. Para determinar la configuración de los bypass a nivel de hardware, consultar el apartado <literal>Segments.</literal></para>			
		</important>
		<para><literal>Segments</literal></para>
		<para>En este apartado se realizará la configuración de los segmentos indicando si disponen o no de bypass.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img030b.png"/>
			</imageobject>
			<caption>
				<para>Edición de segmentos de sensor IPS/IDS</para>
			</caption>
		</mediaobject>
		<para><literal>Groups</literal></para>
		<para>Es posible crear grupos de sensores y de segmentos con el fin de aplicar diferentes políticas para cada uno de ellos. Esta funcionalidad hace que con una sola máquina el usuario pueda crear numerosos entornos a los que aplicar distintas reglas según sus necesidades.</para>
		<para>En este apartado se puede indicar el modo del sensor (recuerde: modo IDS forwarding/IDS span), asignar los segmentos al grupo y las CPUs. Asimismo, puede crear nuevos grupos de sensores mediante la opción <literal>+Add Group.</literal></para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img030c.png"/>
			</imageobject>
			<caption>
				<para>Grupo de sensores</para>
			</caption>
		</mediaobject>
	</section>
	<section>
		<title>Actualización de políticas, fuentes de reglas y activación de reglas por sensor desde la plataforma redBorder</title>
		<para>El último paso para dejar listos los sensores IPS para su interacción con el Manager dentro del escenario de redBorder Malware es la subida de las nuevas versiones de las reglas y la adición de las políticas de firmas que se aplican a diferentes sensores o grupos de sensores.</para>
		<section>
			<title>Actualización de políticas y fuentes de reglas</title>
			<para>La subida y actualización de las versiones de las las reglas consta de dos pasos:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para>Subida de fuentes de reglas</para>
				</listitem>
				<listitem>
					<para>Adición nuevas políticas</para>
				</listitem>
			</orderedlist>
			<para>1) En primer lugar, es necesario realizar la subida de fuentes para las reglas. Para ello hay dirigirse a la sección <emphasis role="bold">Tools>Rules' versions</emphasis> y hacer clic en el botón <literal>Upload Source.</literal> Se debe asignar un nombre y una descripción y adjuntar el archivo que contiene la fuente de reglas.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img034.png"/>
				</imageobject>
				<caption>
					<para>Tools>Rules'versions</para>
				</caption>
			</mediaobject>	
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img035.png"/>
				</imageobject>
				<caption>
					<para>Interfaz de Rules'versions</para>
				</caption>
			</mediaobject>	
			<para>A continuación, hacer clic en <literal>Upload Source</literal>, subir el archivo <literal>file_magic.tar</literal> y añadirle un nombre y una descripción (opcional). Pulsar <literal>Create</literal> para completar la acción de subida.</para>
			<para>Es posible forzar una actualización de las reglas mediante la opción <literal>Force Rule Update</literal> situada en el submenú de cabecera.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img036.png"/>
				</imageobject>
				<caption>
					<para>Subir una fuente de reglas: Upload Source</para>
				</caption>
			</mediaobject>	
			<para>Por último, debe asegurarse de que el check de las versiones de File-Magic se encuentra activado. En el caso de vrt y emergingthreats es opcional, la subida de archivos de fuentes y archivos de fuentes dependerá del tipo de tráfico que se quiera capturar. </para><!--NO me queda claroq ue esta parte esté bien-->
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img037.png"/>
				</imageobject>
				<caption>
					<para>Activación del check de versiones de File-Magic</para>
				</caption>
			</mediaobject>
			<para>2) El siguiente paso se realiza desde la sección <literal>Sensors</literal> y seleccionar el sensor al que queremos aplicarle el conjunto de reglas. Hacer clic en el icono de edición y seleccionar la opción <literal>Signature Policies.</literal></para>
			<para>El usuario accede a una interfaz en la que visualiza un listado con el conjunto de políticas aplicadas a ese sensor, fuentes, número de reglas, propietario, estado, fecha de creación, icono de asignación de políticas a hijos e icono con opciones de edición de reglas.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img031.png"/>
				</imageobject>
				<caption>
					<para>Sensors-Edit>Signature Policies</para>
				</caption>
			</mediaobject>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="350" fileref="images/ch04_img032.png"/>
				</imageobject>
				<caption>
					<para>Interfaz de políticas aplicadas por sensor: +New Policy</para>
				</caption>
			</mediaobject>
			<para>El siguiente paso es añadir una nueva política mediante la opción <literal>+New Policy</literal> que se encuentra en el submenú de cabecera.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img033.png"/>
				</imageobject>
				<caption>
					<para>Añadir nueva política</para>
				</caption>
			</mediaobject>
			<para>En la ventana emergente que aparece, podemos asignar un nombre y una descripción e indicar quién es el sensor propietario de ese conjunto de reglas. A continuación, en el apartado <emphasis role="bold">Rules'Sources</emphasis> activaremos el check de la casilla <emphasis role="bold">Filemagic.</emphasis> En el apartado <emphasis role="bold">Options</emphasis> mantendremos marcadas las casillas "Show only uncommented rules" y "Auto resolve dependencies".</para>
			<para>Para finalizar el proceso, hacer clic en <literal>Create Policy.</literal> La nueva política se visualizará en el listado. Hacer clic en <literal>Apply Conf</literal> para guardar los cambios.</para>
		</section>
		<section>
			<title>Activación de políticas de firmas</title>
			<para>En la sección Sensors encontramos un listado jerárquico en el que se muestran los diferentes sensores IPS que tenemos registrados en el Manager. Cada sensor IPS cuenta con una columna en la que se indican las políticas que se han aplicado a cada sensor. Haciendo clic sobre el botón de las reglas, podremos realizar la activación manual de cada una de ellas.</para>
			<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img035.png"/>
					</imageobject>
					<caption>
						<para>Activación de políticas de firmas: seleccionar sensor</para>
					</caption>
				</mediaobject>
			<para>En el caso de los sensores IPS registrados para Malware es necesario activar el check de las siguientes reglas:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para>Filecapture</para>
				</listitem>
				<listitem>
					<para>Malware</para>
				</listitem>
			</itemizedlist>
			<para>Para que se produzca la activación efectiva de estas reglas hay que indicar la acción <emphasis role="bold">Alert</emphasis> en ambas reglas. Por último, dirigirse a <literal>Options>Apply Conf</literal> para guardar la nueva configuración.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img037.png"/>
				</imageobject>
				<caption>
					<para>Activación de políticas de firmas: activar reglas y programar acción Alerta</para>
				</caption>
			</mediaobject>
			<para>Para realizar un seguimiento de los trabajos de de activación de las reglas, el usuario puede ir a la sección <literal>Tools>Worker and Job Queue.</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch04_img038.png"/>
				</imageobject>
				<caption>
					<para>Activación de políticas de firmas: seguimiento de los trabajos de activación de reglas</para>
				</caption>
			</mediaobject>
		</section>	 
	</section>	
	<section>
		<title>Actualización de Snort</title>
		<para>El último paso para que los sensores IPS queden correctamente configurados, es necesario realizar la actualización de Snort. Este procedimiento implica deshabilitar determinados servicios que son necesarios para la gestión de las reglas. Por este motivo, el sensor debe estar registrado en el Manager y las fuentes de reglas, actualizadas.</para>
		<para>En la terminal del Manager comenzaremos la desactivación de los servicios que pueden verse afectados al configurar los archivos que van a ser sobreescritos:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Watchdog</para>
			</listitem>
			<listitem>
				<para>Chef Client</para>
			</listitem>
			<listitem>
				<para>Snort</para>
			</listitem>
			<listitem>
				<para>Banyard</para>
			</listitem>
		</itemizedlist>
		<para><emphasis role="bold">Parada de los servicios</emphasis></para>
		<para>Para ello ejecutamos el siguiente comando:</para>
		<para><screen>/etc/init.d/watchdog stop &amp;&amp; /etc/init.d/chef-client stop &amp;&amp; /etc/init.d/snortd stop &amp;&amp; /etc/init.d/barnyard2 stop</screen></para>
		<para>Agregamos las reglas en <literal>files.rules</literal> al pie de <literal>/opt/rb/etc/snort/$GROUP/snort-binding-$BINDING/snort.rules</literal></para>
		<para><emphasis role="bold">Actualización de igb driver</emphasis></para>
		<note>
			<title>Nota</title>
			<para>Este paso tan solo es necesario en el caso de disponer de una máquina física con tarjeta 1G.</para>
		</note>
		<para>Para realizar la actualización del driver igb se realizarán las siguientes acciones: </para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Descarga del driver y eliminación de la anterior configuración</para>
				<para><screen>rmmod igb
				rm /tmp/snortd/conf_ethtool_eth*</screen></para>
			</listitem>
			<listitem>
				<para>Copia de la antigua configuración y reemplazo de la misma</para>
				<para><screen>mv /lib/modules/2.6.32-431.el6.x86_64/kernel/drivers/net/igb/igb.ko /lib/modules/2.6.32-431.el6.x86_64/kernel/drivers/net/igb/igb.ko.bak
				mv igb.ko /lib/modules/2.6.32-431.el6.x86_64/kernel/drivers/net/igb/igb.ko</screen></para>
			</listitem>
			<listitem>
				<para>Carga de la nueva configuración y comprobación de que la actualización se ha realizado con éxito (check del comando contra la interfaz igb)</para>
				<para><screen>depmod &amp;&amp; modprobe igb
				[root@rbsensor01 ~]# ethtool -i eth2
				driver: igb
				version: 5.3.2
				...</screen></para>
			</listitem>
		</itemizedlist>
		<para><emphasis role="bold">Configuración de los archivos de Snort: copia de seguridad de los antiguos archivos, adición de nuevos archivos e inserción de nuevas líneas de comando</emphasis></para>
		<para>Una vez que se ha verificado que el driver se ha actualizado correctamente, procedemos a realizar una serie de acciones con los archivos de Snort.</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Copia de todos los archivos de configuración.</para>
				<para><screen># tar czf snort_barnyard2_backup.tgz \
							/opt/rb/bin/snort \
							/opt/rb/bin/barnyard2 \
							/opt/rb/lib/snort/ \
							/opt/rb/lib/snort_dynamicengine/ \
							/opt/rb/lib/snort_dynamicpreprocessor/ \
							/opt/rb/etc/snort/0/snort-binding-0/snort.conf \
							/opt/rb/etc/snort/0/snort-preprocessors-default.conf \
							/opt/rb/etc/snort/0/snort-binding-0/snort.rules \
							/opt/rb/etc/snort/0/gen-msg.map \
							/opt/rb/etc/snort/0/barnyard2.conf</screen></para>
			</listitem>		
			<listitem>
				<para>Descomprimir el archivo <literal>snort.tgz</literal> en el directorio <literal>opt/rb</literal> y actualizar la caché de la librería dinámica: </para>
				<para><screen>tar xvzpf snort.tgz -C /opt/rb &amp;&amp; ldconfig</screen></para>
			</listitem>
			<listitem>
				<para>Copiamos el archivo <literal> /etc/file_magic.conf</literal> en cada grupo: <literal>/opt/rb/etc/snort/$GROUP/</literal></para>
			</listitem>
			<listitem>
				<para>Borramos el contenido de la línea <literal>/opt/rb/etc/snort/$GROUP/snort-binding-$BINDING/so_rules </literal> y descomprimimos el archivo <literal>so_rules.tgz</literal> en ese directorio para cada uno de los bindings.</para>
			</listitem>
			<listitem>
				<para>Añadimos las siguientes líneas bajo la ruta <literal>/opt/rb/etc/snort/$GROUP/snort-preprocessors-default.conf</literal></para>
				<para><screen>include file_magic.conf

						config file:\
							file_type_depth 104857600, \
							file_signature_depth 104857600, \
							file_capture_max 104857600

						preprocessor file_inspect: \
							type_id, \
							capture_queue_size 5000, \
							signature, \
							track_extradata, \
							s3_bucket malware, \
							s3_cluster s3.redborder.cluster, \
							s3_access_key ---, \
							s3_secret_key ---</screen></para>
			</listitem>			
		</itemizedlist>
		<note>
			<title>Nota</title>
			<para>Para que Snort pueda realizar la subida de ficheros es necesario insertar el usuario y la clave de S3 en el Manager que podemos encontrar en:</para>
			<para><screen>/root/.s3cfg-malware</screen></para>
		</note>
		<para><emphasis role="bold">Inicio de Snort y Banyard</emphasis></para> 
		<para>Por último, iniciamos Snort y Banyard mediante el siguiente comando:</para>
		<para><screen>/etc/init.d/snortd start &amp;&amp; /etc/init.d/barnyard2 start</screen></para>
		<warning>
			<title>Advertencia</title>
			<para>No reiniciar ninguno de los servicios de Watchdog o Chef-client</para>
		</warning>
	</section>	
</chapter>
