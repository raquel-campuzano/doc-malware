<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "manual.ent">
<!ENTITY PRODUCT "Documentation">
<!ENTITY BOOKID "manual">
<!ENTITY YEAR "2016">
<!ENTITY HOLDER "Eneo Tecnología S.L. |">
]>
<chapter>
	<title>Endpoint</title>
	<para>El servicio Endpoint ha sido diseñado para la monitorización y análisis de la actividad de los equipos/sistemas 
	que forman parte de la infraestructura de red de una compañía y que serán analizados mediante la App redborder Malware. (En el caso que nos 
	ocupa, los equipos analizados por el Manager de redborder corresponden a aquellos con SO Windows 7). </para> 
	<para>El escenario diseñado para el control de los Endpoints se compone de los siguientes elementos:</para>
	<itemizedlist mark="bullet">
		<listitem>
			<para><emphasis role="bold">Endpoints:</emphasis> equipos o sistemas finales.</para>
		</listitem>
		<listitem>
			<para><emphasis role="bold">Agente de carga:</emphasis> programa que monitoriza la actividad del equipo: procesos creados y destruidos, conexiones generadas por esos procesos y captura de ficheros.
			El agente de carga identifica amenazas gracias al análisis de los ficheros y de los Indicadores de Compromiso (IOC).</para>
		</listitem>
		<listitem>
			<para><emphasis role="bold">Agente GRR:</emphasis> sistema distribuido de monitorización y análisis forense que da soporte a equipos finales, dando respuesta a cualquier incidencia.</para>
		</listitem>
		<listitem>
			<para><emphasis role="bold">Caché local:</emphasis> el agente de carga coteja el hash de los ficheros detectados contra una caché local. En caso de que el hash de dicho fichero
			sea reconocido por la caché local, el fichero no será enviado a S3 para su almacenamiento aunque sí se emitirá un mensaje de Kafka que contiene información sobre el mismo. </para>
		</listitem>
		<listitem>
			<para><emphasis role="bold">Manager:</emphasis></para>
			<para>-Kafka</para>
			<para>-S3</para>
			<para>-Acceso a servidor GRR</para>
		</listitem>
		<listitem>
			<para><emphasis role="bold">Logs:</emphasis> archivo en el que se almacena toda la información relativa al funcionamiento del agente de carga.</para>
		</listitem>
		<listitem>
			<para><emphasis role="bold">Events:</emphasis> actúa a modo de caja negra;
			 en ella se almacenan toda la información relativa a los eventos generados por los procesos, conexiones o ficheros capturados por el Agente de Carga a lo largo del tiempo.  </para>
		</listitem>
	</itemizedlist>
	<section>
		<title>¿Qué acciones se pueden realizar desde la plataforma web redborder para el control de Endpoints?</title>
		<para>El usuario puede realizar diferentes acciones desde el entorno web de redborder tanto para la instalación de los agentes de carga y GRR como para el análisis y tratamiento 
		de la información proporcionada por ellos: </para>
		<itemizedlist mark="bullet">
			<listitem>
				<para><emphasis role="bold">Descarga del Endpoint:</emphasis> instalación del Agente de Carga y GRR. </para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Visualización de datos de Endpoints:</emphasis> desde la plataforma redborder el usuario puede
				consultar información relativa a cada dispositivo y su estado.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Alertas/Snapshots:</emphasis> Información sobre cambios de estado de los Endpoints y descarga de Snapshots o capturas que permiten realizar un análisis 
				comparativo del estado de los endpoints en un momento determinado.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Aplicación de mecanismos de contención:</emphasis> desde la plataforma web redborder es posible controlar la conexión
				del Endpoint con el Agente y servidor GRR para tomar medidas de protección de los equipos finales.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Descarga de los eventos de logs:</emphasis> Descarga de información detallada de la actividad registrada por el Agente de Carga. </para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Configuración de periodicidad de descarga de las Snapshots y acceso al panel GRR</emphasis> 
				</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Visualización de eventos Malware: </emphasis> relacionados con los cambios de estado de los Endpoints. </para><!--revisar esto-->
			</listitem>
		</itemizedlist>
	</section>
	<section>
		<title>Descarga e instalación del Endpoint</title>
		<para>El primer paso que debe realizar todo usuario es la descarga del software Endpoint para su instalación en un equipo final. Una vez instalado, el equipo
		podrá comunicarse con el Agente de carga y GRR; de este modo la plataforma web redborder podrá recibir toda la información relacionada con este punto de acceso.</para>
		<para>La descarga del Endpoint se realiza en cuatro sencillos pasos y su instalación es completamente transparente para el usuario:</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para>Acudir a la sección Sensors->View</para>
			</listitem>
			<listitem>
				<para>Seleccionar en el menú View la opción <literal>Endpoints</literal></para>
			</listitem>
			<listitem>
				<para>Hacer clic en <literal>New Endpoint Installer</literal> para comenzar el procedimiento de descarga del archivo ejecutable (formato .zip) preparado para la instalación del Endpoint que incluye tanto 
				el archivo de instalación del Agente de carga como el de GRR.</para>
				<para>Seleccionar la distribución o arquitectura del sistema: 32/64bits.</para>
				<para>Hacer clic en <literal>Create</literal> para finalizar el proceso de descarga del fichero.</para>
			</listitem>
			<listitem>
				<para>Descomprimir el archivo .zip y ejecutarlo. Recuerde que, para este último paso, el usuario debe poseer los privilegios de <emphasis role="bold">administrador</emphasis>
				del sistema.</para>
			</listitem>
		</orderedlist>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img001.png"/>
			</imageobject>
			<caption>
				<para>Sensors->View</para>
			</caption>
		</mediaobject>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img002.png"/>
			</imageobject>
			<caption>
				<para>View->New Endpoint Installer</para>
			</caption>
		</mediaobject>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img003.png"/>
			</imageobject>
			<caption>
				<para>Creación de un Endpoint</para>
			</caption>
		</mediaobject>
		<section>
			<title>Requisitos para la instalación del Endpoint</title>
			<para>Una vez que el usuario se ha descargado el instalador en su equipo el siguiente paso es descomprimir el archivo ejecutable que contiene los siguientes ficheros que contienen las 
			configuraciones necesarias para que el Agente de Carga y GRR funcionen de manera correcta.</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para>redBorder_endpoint_[arquitectura].msi (instalador)</para>
				</listitem>
				<listitem>
					<para>parameters.yml</para>
				</listitem>
				<listitem>
					<para>hosts</para>
				</listitem>
				<listitem>
					<para>S3.redborder.cluster.crt</para>
				</listitem>
				<listitem>
					<para>GRR_[version]_[arquitectura].exe</para>
				</listitem>
			</itemizedlist>
			<para>Uno de los elementos que son instalados al ejecutar el fichero Endpoint es el Agente de Carga. Este se encuentra autocontenido en el fichero instalador.
			Dependiendo de la distribución de su sistema, el Agente de Carga se instalará en un directorio u otro: </para>
			<para><emphasis role="bold">32 Bits:</emphasis></para>
			<para><screen>endpoint_installer_32-> c:\Program Files\redBorder Malware EndPoint</screen></para>
			<para><emphasis role="bold">64 Bits:</emphasis></para>
			<para><screen>endpoint_installer_64-> c:\Program Files\redBorder Malware EndPoint</screen></para>
			<para><screen>endpoint_installer_32-> c:\Program Files (X86)\redBorder Malware EndPoint</screen></para>
			<para>Una vez que ha sido instalado el Endpoint este será reconocido por el sistema como un servicio más de Windows por lo que el usuario podrá manejarlo como tal.</para>
			<note>
				<title>Nota </title>
				<para>Durante el proceso de instalación del Agente de Carga, se descargarán los siguientes elementos para el correcto funcionamiento del mismo:</para>
				<para>-Python 3.4.3</para>
				<para>-Librerías de Python: pywin32, pysha3, psutil, pip.</para>
				<para>-Certificado de S3 en el store de Windows dentro del apartado del navegador "Certificaciones de confianza raíz"</para>
				<para>-Actualización de etc/hosts</para>
				<para>-Agente de carga como servicio de Windows</para>
			</note>
		</section>
		<section>
			<title>Proceso de verificación de la instalación del Endpoint</title>
			<para>Existen dos métodos para verificar que la instalación se ha realizado correctamente en su equipo: verificación básica y
			verificación avanzada.</para>
			<para><emphasis role="bold">Verificación básica de la instalación</emphasis></para>
			<para>Para realizar una verificación rápida el usuario debe buscar el archivo de confirmación de la instalación que podrá encontrar en la siguiente ruta:
			Archivos de programa->redBorder Malware Endpoint->InstallLog. </para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img004.png"/>
				</imageobject>
				<caption>
					<para>Verificación básica de la instalación del Endpoint</para>
				</caption>
			</mediaobject>
			<para>Si la instalación ha sido correcta, el usuario al abrir el archivo visualizará un mensaje similar al que aparece en la siguiente imagen: </para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img005.png"/>
				</imageobject>
				<caption>
					<para>Verificación básica de la instalación del Endpoint: Mensaje archivo InstallLog</para>
				</caption>
			</mediaobject>
			<para><emphasis role="bold">Verificación avanzada de la instalación</emphasis></para>	
			<para>Para obtener una confirmación exhaustiva de que el Endpoint ha sido instalado correctamente se deben seguir los siguientes pasos: </para>
			<orderedlist numeration="arabic">
				<listitem>
					<para><emphasis role="bold">Comprobar que el certificado autofirmado de redborder Malware para S3 ha sido instalado en el almacén de Windows:</emphasis> introducir en el Inicio 
					<literal>certmgr.msc.</literal></para>
					<para><screen>Certificados-Usuario actual\Entidades de certificación raíz de confianza\</screen></para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img006.png"/>
						</imageobject>
						<caption>
							<para>Verificación avanzada de la instalación del Endpoint: comprobación de la instalación correcta del certificado S3.</para>
						</caption>
					</mediaobject>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Actualización del fichero del sistema "etc/hosts":</emphasis> añadir el contenido del fichero "hosts" incluido en la carpeta descomprimida. Este fichero se
					encuentra en la siguiente ruta: <screen>Windows\System32\drivers\etc\hosts</screen></para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img007.png"/>
						</imageobject>
						<caption>
							<para>Verificación avanzada de la instalación del Endpoint: Actualización fichero "etc/hosts"</para>
						</caption>
					</mediaobject>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img008.png"/>
						</imageobject>
						<caption>
							<para>Verificación avanzada de la instalación del Endpoint: Contenido del fichero "etc/hosts"</para>
						</caption>
					</mediaobject>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Comprobar la existencia de los servicios GRR y Endpoint:</emphasis> para ello, basta con buscar en el inicio de Windows el directorio "Servicios" y comprobar si en el listado de servicios locales 
					se encuentran <literal>Endpoint Service</literal> y <literal>GRR Monitor.</literal></para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img009.png"/>
						</imageobject>
						<caption>
							<para>Verificación avanzada de la instalación del Endpoint: Comprobación de la instalación de los servicios Endpoint y GRR</para>
						</caption>
					</mediaobject>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Acceder al Visor de eventos de Windows para comprobar que el servicio Endpoint se ha iniciado sin errores.</emphasis></para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img010.png"/>
						</imageobject>
						<caption>
							<para>Verificación avanzada de la instalación del Endpoint: el servicio Endpoint se ha iniciado sin errores</para>
						</caption>
					</mediaobject>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Comprobación de los logs de la aplicación:</emphasis> es posible revisar las entradas de los logs de la aplicación
					para comprobar que el Agente de Carga se ha iniciado sin errores. En caso de que los servicios no se hubiera activado de manera correcta visualizaríamos en la entrada
					la palabra <literal>WARNING.</literal></para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img011.png"/>
						</imageobject>
						<caption>
							<para>Verificación avanzada de la instalación del Endpoint: comprobación de los logs de la aplicación</para>
						</caption>
					</mediaobject>
				</listitem>
			</orderedlist>
		</section>	
	</section>
	<section>
		<title>Visualización de datos de Endpoints</title>
		<para>El usuario puede llevar un control de los Endpoints que hay instalados y de su estado desde la plataforma web redborder.</para>
		<para>Para consultar los Endpoints hay que dirigirse a la sección <literal>Sensors</literal> y seleccionar la opción <literal>View->Endpoints.</literal></para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="150" fileref="images/ch08_img012.png"/>
					</imageobject>
				<caption>
					<para>Visualización de datos de Endpoints: Sensors->View->Endpoints</para>
				</caption>
		</mediaobject>
		<para>Una vez que se ha accedido a esta interfaz se visualiza un listado en el que aparecen todos los Endpoints que se han registrado contra el servidor GRR. Este listado incluye la siguiente
		información relacionada con cada Endpoint:</para>
		<itemizedlist>
			<listitem>
				<para><emphasis role="bold">Name:</emphasis> nombre del Hostname del Endpoint asignado por el usuario.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">GRR ID:</emphasis> ID interno del Endpoint (C.+Número en hexadecimal de 16 dígitos).</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">IP:</emphasis> IP del Endpoint.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Last Check in:</emphasis> indica la última vez que el Endpoint fue chequeado estando perativo. </para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Owner:</emphasis> propietario del Endpoint (por defecto: root).</para>
			</listitem>
		</itemizedlist>
		<para>En el margen superior derecho de la pantalla encontramos dos nuevas opciones:</para> 
		<orderedlist numeration="arabic">
			<listitem>
				<para>New Endpoint Installer: descarga del instalador del Endpoint. </para>
			</listitem>
			<listitem>
				<para>Discover Endpoints: actualización del listado de Endpoints mediante la consulta al servidor GRR, añadiendo o eliminando aquellos Endpoints que se hayan gestionado desde el panel de Administración de GRR. </para>
				<para>Si un Endpoint ha sido eliminado desaparece del listado de Endpoints. Sin embargo, se guarda un registro del mismo añadiendo la etiqueta "DELETED", de este modo, si se desea realizar una consulta histórica
				mediante un filtro por franja de tiempo, obtendremos información de la actividad de este Endpoint con la indicación de que ha sido eliminado.</para>
			</listitem>
		</orderedlist>
		<para>Para ver la información completa asociada a cada uno de los Endpoints basta con hacer clic en el icono de "Edición": </para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="50" fileref="images/ch08_img013.png"/>
					</imageobject>
				<caption>
					<para>Visualizar datos de un Endpoint concreto</para>
				</caption>
		</mediaobject>
		<para>A continuación accedemos a una pantalla en la que encontramos información detallada sobre el estado del Endpoint acompañada de una serie de botones que nos permitirán activar una serie 
		  de mecanismos de contención para proteger a los Endpoints en casos de vulnerabilidades o amenazas.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img014.png"/>
					</imageobject>
				<caption>
					<para>Detalle de información Endpoint</para>
				</caption>
		</mediaobject>
		<para>En esta misma pantalla se encuentra la opción <literal>Download Event Log</literal> que permite realizar la descarga del registro de Logs en formato .json. El usuario puede seleccionar el intervalo de tiempo
		 del que quiere obtener la información acerca de la actividad del Agente de carga.</para>
		<para>El archivo <emphasis role="bold">Event Log</emphasis> incluye los datos sobre los procesos del sistema, conexiones y acciones realizadas en ficheros (creación, modificación y eliminación). Existen tres modos 
		en los que encontramso los logs: Informativos, Depuradores (Debug) y Error.</para>
		<para>El usuario puede consultar el registro de la actividad del sistema en el archivo local de su equipo y que puede consultar en <literal>c:\Archivos de programa\redborder Malware Endpoint\Events</literal>.</para>
		<note>
			<title>Nota</title>
			<para>El registro de logs almacenado en su equipo tiene unas limitaciones de tamaño de almacenamiento, por lo que periódicamente los registros son borrados
			de manera automática por el sistema. </para>
			<para>Si desea un informe exhaustivo de la actividad de sus equipos le recomendamos que realice siempre la descarga de los Logs desde la plataforma web redborder, ya que su almacenamiento es ilimitado.</para>
		</note>
	</section>
	<section>
		<title>State changes</title>
		<para>Otra de las acciones que puede realizar el usuario para comprobar los cambios de estado de los Endpoints y obtener información sobre los procesos que se 
		han activado en un periodo de tiempo es consultar la interfaz <literal>Malware->(Vistas)->State Changes.</literal></para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="150" fileref="images/ch08_img015.png"/>
					</imageobject>
				<caption>
					<para>Ver cambios de estado de los Endpoints</para>
				</caption>
		</mediaobject>
		<para><emphasis role="bold">State Changes</emphasis> es un programa que realiza el análisis de la actividad de los Endpoints. En esta interfaz es posible la descarga de un archivo .csv que incluye las diferencias
		 observadas entre un periodo de tiempo y el momento de la consulta.</para>
		 <para>El Agente de Carga recoge todos los procesos creados y destruidos, las conexiones generadas por esos procesos y las capturas de los ficheros e identifica las amenazas
		 mediante el análisis de ficheros y los Indicadores de Compromiso (IOCs).</para>
		<para>Como se puede observar en la imagen, en esta pantalla encontramos un listado que incluye todos los endpoints (identificados a través de su Hostname e IP), información del tipo de proceso (estado de procesos/estados 
		de red) y los botones de descarga del anterior archivo csv generado y el nuevo, de modo que el usuario pueda fácilmente realizar una comparación de los cambios de estado (Old CSV/ New CSV).</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img016.png"/>
					</imageobject>
				<caption>
					<para>Interfaz State Changes</para>
				</caption>
		</mediaobject>
		<para><emphasis role="bold">Opciones de filtrado de cambios de estado:</emphasis></para>
		<orderedlist numeration="arabic">
			<listitem>
				<para>View: Show everything, Show only reviewed elements, Show only unreviewed elements.</para>
				<para>La casilla <literal>Reviewed</literal> posibilita que el usuario marque aquellos Endpoints que ya ha supervisado y tener disponible las diferentes opciones de filtrado.</para>
			</listitem>
			<listitem>
				<para>Filtrado por rango temporal: seleccionar el periodo que desea analizar en la barra de filtrado temporal del margen superior izquierdo.</para>
			</listitem>
		</orderedlist>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img017.png"/>
					</imageobject>
				<caption>
					<para>Opciones de visualización en State Changes</para>
				</caption>
		</mediaobject>
	</section>
	<section>
		<title>Mecanismos de contención</title>
		<para>Como se ha explicado en la sección "Visualización de datos de Endpoints" existen una serie de mecanismos de contención para  asegurar la protección de los Endpoints y que son accesibles desde la interfaz 
		<literal>Sensors->View->Endpoints (icono edición).</literal></para>
		<para>Las acciones que se encuentran disponibles en esta sección son las siguientes:</para>
		<itemizedlist>
			<listitem>
				<para><emphasis role="bold">Start Agent:</emphasis> Reinicia el agente GRR. </para><!--duda: grr o de carga-->
			</listitem>
			<listitem>
				<para><emphasis role="bold">Stop Agent:</emphasis> Para el agente GRR. </para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Block Endpoint:</emphasis> Bloquea las conexiones entre el Endpoint y el servidor GRR. (La comunicación con el Manager seguirá activa para que
				sea posible el reestablecimiento de las conexiones con el Endpoint).</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Unblock Endpoint:</emphasis> Reestablece las conexiones entre el Endpoint y el servidor GRR.</para>
			</listitem>
		</itemizedlist>
		<warning>
			<title>Advertencia</title>
			<para>Cuando el usuario quiera bloquear las conexiones de los Endpoints con el servidor GRR  deberá indicar
			separadas por comas, qué Endpoints mantendrán la comunicación (indicando sus IPs). En caso contrario, se bloquearán las conexiones con todos los Endpoints reconocidos por el sistema. </para>
		</warning>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="350" fileref="images/ch08_img018.png"/>
					</imageobject>
				<caption>
					<para>IPs de Endpoints que mantienen conexión</para>
				</caption>
		</mediaobject>
	</section>
	<section>
		<title>Configuración de periodicidad de descarga de las Snapshots y acceso al panel GRR</title>
		<para>Desde la interfaz <literal>Tools->Malware Settings</literal> el usuario puede fijar la periodicidad
		de descarga de las capturas o informes de Cambios de Estado y realizar diferentes acciones para la comunicación con el servidor GRR. </para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img019.png"/>
					</imageobject>
				<caption>
					<para>Periodicidad descarga Snapshots</para>
				</caption>
		</mediaobject>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img020.png"/>
					</imageobject>
				<caption>
					<para>Configuración y acciones sobre el servidor y servicios GRR</para>
				</caption>
		</mediaobject>
		<para><emphasis role="bold">GRR Server</emphasis></para>
		<para>En este apartado el usuario puede realizar las siguientes acciones:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Introducir la IP del servidor GRR</para>
			</listitem>
			<listitem>
				<para>Introducir nombre de usuario/password de la API GRR</para>
			</listitem>
			<listitem>
				<para>Parar/reiniciar servicios del servidor GRR</para>
			</listitem>
			<listitem>
				<para>Actualización de password SSH</para>
			</listitem>
			<listitem>
				<para>Acceso al panel de administración de GRR</para>
			</listitem>
			<listitem>
				<para>Visualización del estado de los servicios de GRR</para>
			</listitem>		
		</itemizedlist>
	</section>
	<section>
		<title>Indicadores de compromiso: IOCs</title>
		<para>El Manager analiza e identifica las amenazas gracias a las reglas incluidas en los Indicadores de Compromiso o IOCs y a la información de cada Endpoint que es reportada por el Agente de carga.</para>
		<para>Los IOCs se componen de una serie de reglas cuyo cumplimiento o no determinan la activación o desactivación de los mismos. En caso de que los procesos capturados coincidan con alguna regla
		estos se visualizarán como eventos en la sección Malware, indicando el o los Endpoints que se han visto comprometidos por la activación de uno o más IOCs. </para>
		<para>Esta información se puede visualizar en <literal>Malware->View->IOCs.</literal></para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch08_img021.png"/><!--captura-->
			</imageobject>
			<caption>
				<para>Vista IOCs en la sección de eventos Malware</para>
			</caption>
		</mediaobject>
		<para>En esta vista se pueden observar los eventos generados por el cumplimiento de las reglas contenidos en los IOCs que se hayan definido y que han provocado la activación de los mismos. </para>
		<para>En la tabla resumen se muestra el total de Enpoints comprometidos y el total de IOCs que se han activado:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para><literal>Number of compromised EndPoints</literal>: Número total de Endpoints comprometidos</para>
			</listitem>
			<listitem>
				<para><literal>Number of active IOCs</literal>: Cantidad total de IOCs activos</para>
			</listitem>
			<listitem>
				<para><literal>Mean of IOCs/EndPoint</literal>:</para>
			</listitem>
		</itemizedlist>
		<para>A continuación se visualiza un listado que incluye todos los Endpoints que se han visto comprometidos (cuya actividad ha activado una o varias reglas de los IOCs definidos) 
		acompañados de la siguiente información:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para><literal>EndPoint ID</literal>: Identificador del Endpoint.</para>
			</listitem>
			<listitem>
				<para><literal>Compromised since:</literal> fecha en la que se activó el IOC y se consideró que dichoEndpoint podía estar comprometido. </para>
			</listitem>
			<listitem>
				<para><literal>Number of active IOCs</literal>: número de IOCs que se han activado para ese EndPoint.</para>
			</listitem>
			<listitem>
				<para><literal>IOC IDs:</literal> identificador/es de los IOCs que se han activado para dicho EndPoint. </para>
			</listitem>
			<listitem>
				<para><literal>Detailed information:</literal> información detallada.</para>
			</listitem>
		</itemizedlist>
		<section>
			<title>Definición de las reglas IOC</title>
			<para>La adición y definición de las reglas que se integran en los indicadores de compromiso se deben definir en el archivo 
			<literal>/root/chef/cookbooks/redBorder-manager/templates/default/samza-ioc.properties.erb</literal>.</para>
				<para>Existen un número infinito de reglas que se pueden determinar para un IOC ya que dependen siempre
			de las necesidades de los usuarios.</para>
			<para> Los IOC (<literal>net.redborder.ioc</literal>) pueden estar definidos a través de dos tipos de reglas: </para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><emphasis role="bold">Reglas de procesos:</emphasis> net.redborder.ioc.rules.memory</para>
				</listitem>
				<listitem>
				<para><emphasis role="bold">Reglas generales: </emphasis>net.redborder.ioc.rules</para>
				</listitem>
			</itemizedlist>
			<note>
				<title>Nota</title>
				<para>Todas las reglas, ya sean de procesos o generales, presentan algunos campos comunes:</para>
				<para><emphasis role="bold">-uuid=</emphasis> identificador de la regla; compuesto por una cadena alfanumérica de caracteres.</para>
				<para><emphasis role="bold">-Type=</emphasis> descripción del tipo de regla.</para>
				<para><emphasis role="bold">-Baserule=</emphasis> regla en sí misma.</para>
				<para><emphasis role="bold">-EnabledConditions/DisabledConditions=</emphasis> incluyen los criterios de activación o desactivación de una regla.</para>
			</note>
			<para>Los campos que definen la activación o desactivación de una regla <literal>EnabledConditions</literal>/<literal>DisabledConditions</literal>
			deben estar compuestos por alguno de los criterios siguientes: </para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><literal>AND:</literal> unión de reglas con el "y" lógico. </para>
				</listitem>
				<listitem>
					<para><literal>OR:</literal> unión de reglas con el "o" lógico.</para>
					</listitem>
				<listitem>
					<para><literal>CONTAINS:</literal> describe el elemento que debe estar contenido en uno de los campos del reporte
					del Agente de carga.</para>
				</listitem>
				<listitem>
					<para><literal>FIELD:</literal> coincidencia exacta.</para>
				</listitem>
			</itemizedlist>
			<para>A continuación se describe la sintaxis de cada una de las reglas que pueden formar un IOC.</para>
			<section>
				<title>net.redborder.ioc</title>
				<para>Esta línea contiene la referencia (uuid) del IOC definido y el uuid de las reglas que contiene dicho IOC (y que han sido definidas en la línea
				"rules" y "memory"). Su sintaxis es como sigue: </para>
				<para><screen>net.redborder.ioc: [{"uuid":"uuidIOC", "rules":[“uuid1”,”uuid2”]}]</screen></para>
				<itemizedlist mark="circle">
					<listitem>
						<para>uuidIOC= identificador del IOC; cadena alfanumérica de caracteres</para>
					</listitem>
					<listitem>
						<para>rules= uuid de las reglas definidas por el usuario</para>
					</listitem>
				</itemizedlist>
				<warning>
					<title>Advertencia</title>
					<para>Se recomienda la asignación de uuid diferentes tanto para las reglas como para los IOCs para evitar posibles errores en la activación/desactivación de los mismos.</para>
				</warning>
			</section>
			<section>
				<title>net.redborder.ioc.rules.memory</title>
				<para>Las reglas <literal>memory</literal> diferencian procesos ejecutados en el Endpoint a través de su "pid".</para>
				<para>Esta es la sintaxis genérica que rige este tipo de reglas:</para>
				<para><screen>net.redborder.ioc.rules.memory: [{regla 1}, {regla n}]</screen></para>
				<para>La sintaxis genérica para cada una de las reglas de procesos es la siguiente: </para>
				<para><screen>net.redborder.ioc.rules.memory: [{"uuid":"uuid0", "type":"memory", "baseRule":{"type":"field","enabledConditions":{"type":"process","campo":"valor"}}, "memoryField":"pid”}]</screen></para>
				<para>Las reglas de procesos tienen una serie de campos invariables: </para>
				<itemizedlist mark="bullet">
					<listitem>
						<para>"type":"memory"</para>
					</listitem>
					<listitem>
						<para>"type":"field"</para>
					</listitem>
					<listitem>
						<para>"memoryField":"pid”</para>
					</listitem>
				</itemizedlist>
				<para>Este es un ejemplo de regla de procesos:</para>
				<para><screen>net.redborder.ioc.rules.memory: [{"uuid":"baaa", "type":"memory", "baseRule":{"type":"field","enabledConditions":{"type":"process","name":"svchost.exe"}}, "memoryField":"pid”}]</screen></para>
			</section>
			<section>
				<title>net.redborder.ioc.rules</title>
				<para>Esta línea contiene las reglas definidas por el usuario (reglas generales). A continuación se muestra la sintaxis genérica para este tipo de reglas 
				(donde Regla 1 es una regla que contiene como criterio AND/OR y regla 2 es una regla que contiene
				como criterio CONTAIN/FIELD:</para>
				<para><screen>net.redborder.ioc.rules: [regla 1, regla 2, regla n]</screen></para>
				<para>La sintaxis genérica para cada una de las reglas es la siguiente: </para>
				<para><screen>regla 1: {"uuid":"uuid1", "type":"or","rules":[{"type":"field","enabledConditions":{"campo":"valor"},{"type":"contains","disabledConditions":{"campo":"valor"}}</screen></para>
				<para><screen>regla 2: {"uuid":"uuid2", "type":"contains","rules":[{"type":"field","enabledConditions":{"campo":"valor"}}</screen></para>
				<para>Este es un ejemplo de regla general (tipo 1): </para>
				<para><screen>net.redborder.ioc.rules: [{"uuid":"aaaa", "type":"or","rules":[{"type":"field","enabledConditions":{"md5":"3EC4DE9EF2E158473208842F4631236A"}},
				{"type":"field","enabledConditions":{"md5":"A670FF4997247322200FD925CC78C94F”}}]}]</screen></para>
			</section>
		</section>
	</section>
</chapter>
