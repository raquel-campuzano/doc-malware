<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "manual.ent">
<!ENTITY PRODUCT "Documentation">
<!ENTITY BOOKID "manual">
<!ENTITY YEAR "2014">
<!ENTITY HOLDER "Eneo Tecnología S.L. |">
]>
<chapter>
	<title>Configuración y registro de los sensores Gateway</title>
	<para>El proceso de instalación del sensor Gateway consta fundamentalmente de tres pasos: configuración de red, registro del sensor en el Manager y configuración de los parámetros generales del sensor en la plataforma redBorder. Para ello, deberá disponer del asistente de instalación (imagen ISO) obtenido mediante descarga o a través del DVD facilitado por redBorder. </para>
	<para>Al poner en funcionamiento el asistente de instalación, visualizaremos el menú principal en el que encontrará la opción <literal>Install Sensor Gateway</literal>:</para>
	<mediaobject>
		<imageobject>
			<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img001.png"/>
		</imageobject>
		<textobject>
			<phrase>Asistente de instalación redBorder: Instalar sensor Gateway</phrase>
		</textobject>
		<caption>
			<para>Asistente de instalación redBorder: Instalar sensor Gateway</para>
		</caption>
	</mediaobject>
	<para>A continuación el usuario deberá introducir su nombre de usuario y contraseña <footnote><para>El nombre de usuario y contraseña que se deben introducir en este paso corresponden con los que se han indicado en el proceso de instalación del Manager ys erán los que le sirvan para acceder a la plataforma web redBorder.</para></footnote>, así como ejecutar el comando rb_sysconf:</para>
    <itemizedlist mark="bullet">
		<listitem>
			<para>Login</para>
		</listitem>
		<listitem>
			<para>Password</para>
		</listitem>
		<listitem>
			<para>Comando rb_sysconf</para>
		</listitem>
	</itemizedlist>	
	<para>Este proceso es idéntico al expuesto en la <emphasis role="bold">Finalización del proceso de instalación del asistente para la configuración del Manager.</emphasis></para>
	<section>
		<title>Configuración de red de los sensores Gateway</title>
		<para>Una vez ha ejecutado el comando <literal>rb_sysconf</literal> accederá al <emphasis role="bold"> Menú de Configuración redBorder.</emphasis></para>
		<para>Este menú consta de 4 opciones:</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para><literal>System Configuration:</literal>desde esta opción se pueden definir y modificar una serie de ajustes básicos del sistema como el nombre, hora, tipo de teclado, etc.</para>
			</listitem>
			<listitem>
				<para><literal>Network Configuration:</literal> esta es la opción desde la cual se realizan todas las configuraciones de red para la correcta implantación de la solución.</para>
			</listitem>
			<listitem>
				<para><literal>Passwords:</literal> acceda a esta opción si desea modificar sus contraseñas.</para>
			</listitem>
			<listitem>
				<para><literal>Backup System:</literal> permite realizar una copia de seguridad de la configuración.</para>
			</listitem>
			<listitem>
				<para><literal>quit:</literal> Salir.</para>
			</listitem>
		</orderedlist>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img002.png"/>
			</imageobject>
			<textobject>
				<phrase>Menú de configuración redBorder</phrase>
			</textobject>
			<caption>
				<para>Menú de configuración redBorder</para>
			</caption>
		</mediaobject>
		<note>
			<title>Nota</title>
			<para>Recuerde: selección de opciones predeterminadas: <keycap>Enter</keycap></para>
		</note>
		<section>
			<title>Pasos para la configuración de red de los sensores Gateway</title>
			<para>Como se ha comentado al inicio del capítulo, el primer paso para comenzar la configuración de los sensores Gateway es el establecimiento de los parámetros de red o puesta en red de los sensores.</para>	
			<para>Para comenzar le proceso seleccionar la opción <literal>2) Network Configuration</literal> del menú de Configuración redBorder.</para>
			<para>Estos son los pasos que hay que seguir para realizar la instalación de los sensores Gateway:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para>Configuración de la red de gestión:</para>
					<para>Creación del bond y asignación de interfaz de gestión.</para>
				</listitem>
				<listitem>
					<para>Configuración DNS y dominio</para>
				</listitem>
			</orderedlist>
			<note>
				<title>Nota</title>
				<para>El orden que se siga en los pasos que comprenden la configuración de la red de gestión es indiferente. El orden indicado en este manual de instalación es el que se considera más óptimo.</para>
				<para>Hasta que no se haya realizado esta configuración, no se podrá proceder al registro de los sensores en el Manager.</para>
			</note>
			<warning>
				<title>Advertencia</title>
				<para>Para la instalación y registro de los sensores Gateway es necesario disponer de tan solo un bond.</para>
				<para>En caso de que el sistema se instale en un equipo real que disponga de más de una tarjeta de red, el usuario deberá elegir cuál será el bond de gestión.</para>
			</warning>
			<section>
				<title>Creación de un nuevo bond y asignación de puertos</title>
				<para>Una vez que hemos accedido al <literal>redBorder Network configuration menu</literal> seleccionamos la opción <literal>1) Management Network Configuration</literal> desde la cual podremos realizar la creación de un bond para la instalación del sensor.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img003.png"/>
					</imageobject>
					<caption>
						<para>redBorder Network Configuration menu: selección de la opción 1) Management Network Configuration para la creación de un bond </para>
					</caption>
				</mediaobject>
				<para>Para ilustrar este proceso crearemos un bonding (bond0) y le asignaremos 2 puertos.</para>
				<para>Seleccione la opción <keycap>n</keycap> que aparece en el submenú lateral derecho de la pantalla.</para>
				<para>Una vez que haya revisado los puertos que se encuentran disponibles, seleccione aquel que desea asignar al bonding, tal y como aparece en el margen inferior de la pantalla anterior.</para>
				<para>Introduzca el número de puerto en la línea <literal>Insert bonding first port [0]:</literal></para>
				<para>El número que aparece entre corchetes <literal>[]</literal> es el que define el sistema por defecto. Para seleccionar este número, pulse <keycap>Enter.</keycap></para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img004.png"/>
					</imageobject>
					<caption>
						<para>Creación de un bond: asignación de puertos</para>
					</caption>
				</mediaobject>
				<para>El puerto seleccionado desaparecerá de la opción de puertos disponibles.</para>
				<important>
					<title>Importante</title>
					<para>El sistema solo permite la creación de un máximo de 4 bonds: (0-3).</para>
				</important>
			</section>
			<section>
				<title>Finalizar el proceso de creación del bonding</title>
				<para>Antes de aplicar cambios y finalizar el proceso de creación del bonding el sistema le mostrará una tabla en la que figuran el nuevo bonding creado (bond0) junto con los puertos que le han sido asignados, la IP y Máscara y la ruta asignadas.</para>	
				<para><emphasis role="bold">Aplicar cambios</emphasis></para>
				<para>Para que las modificaciones realizadas queden guardadas, debe realizar la acción de aplicar cambios, seleccionando la opción <keycap>a.</keycap></para>
				<para>Puede borrar en cualquier momento el/ los bonds creados seleccionado la opción <literal>delete bonding</literal> insertando la letra <keycap>d.</keycap></para>
				<para>Para volver al menú principal de configuración de red, seleccionar la opción <literal>quit</literal> con la letra <keycap>q.</keycap></para>
			</section>
		</section>
		<section>
			<title>Configuración DNS y dominio</title>
			<para>Al salir del <literal>1) Management Network configuration</literal> volvemos a la interfaz del <literal>redBorder Network configuration menu</literal> en el que encontramos la opción de configuración de DNS y dominio. Inicie la configuración seleccionando: <literal>2) DNS and domain settings.</literal></para>
			<para>Para realizar la configuración correctamente, el usuario deberá introducir:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para>Nombre de Dominio</para>
				</listitem>
				<listitem>
					<para>Dirección DNS primaria</para>
				</listitem>
				<listitem>
					<para>Dirección DNS secundaria (opcional)</para>
			</listitem>
		</itemizedlist>
		<para>Una vez introducida esta información, el sistema avisará de que se ha aplicado esta configuración de manera correcta.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img005.png"/>
			</imageobject>
		<caption>
			<para>Configuración DNS y dominio</para>
		</caption>
			</mediaobject>
			<para>Para finalizar el proceso, es necesario aplicar cambios: seleccionar la opción <literal>apply</literal> insertando la letra <keycap>a</keycap> en el menú principal de configuración de red.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img006.png"/>
				</imageobject>
				<caption>
					<para>Configuración DNS y dominio</para>
				</caption>
				</mediaobject>
		</section>
	</section>		
	<section>
		<title>Registro de los sensores en el Manager</title>
		<para>Para finalizar el proceso de instalación de los sensores Gateway, el último paso que debe llevarse a cabo es el <emphasis role="bold">Registro de los sensores en el Manager.</emphasis></para>
		<para>Hasta que no se haya completado el registro, se visualizará un mensaje en el que se indica que los sensores aún no han sido registrados en el Manager. </para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img007.png"/>
			</imageobject>
			<caption>
				<para>Inicio del regsitro de los sensores en el Manager</para>
			</caption>
	    </mediaobject>	
		<para>En el menú de registro de los sensores en el Manager encontramos las siguientes opciones:</para>
		<orderedlist numeration="arabic">
			<listitem>
				<para><literal>Hostname [rbsensor]:</literal> asignar un nombre al sensor.</para>
			</listitem>
			<listitem>
				<para><literal>Set local time:</literal> configurar hora local.</para>
			</listitem>
			<listitem>
				<para><literal>IP adress for rB Master Manager [127.0.0.1]:</literal> introducir la IP del Manager.</para>
			</listitem>
			<listitem>
				<para><literal>Register rB Sensor/Manager:</literal> registro de los sensores en el manager Sensor/Manager. Hasta que no se haya completado el proceso de registro el usuario visualizará el siguiente mensaje rotulado en rojo: <literal>(not registered yet)</literal></para>
			</listitem>
		</orderedlist>
		<section>
			<title>Asignar nombre al sensor (Hostname)</title>
			<para> Seleccionar la opción <literal>Hostname [rbsensor]</literal> del menú de registro de los sensores en el Manager insertando el número <keycap>1.</keycap></para>
			<para> A continuación, en la línea <literal>Insert Hostname [rbsensor]:</literal> escribir el nombre que se desea dar al sensor que se va a registrar en el Manager. A partir de este momento, este es el nombre que visualizará en la web cuando acceda al listado de sensores IPS.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img009.png"/>
				</imageobject>
			<caption>
				<para>Asignar nombre al sensor</para>
			</caption>
			</mediaobject>
			<note>
				<title>Nota</title>
				<para>Recuerde introducir un nombre coherente para el sensor. Evite utilizar el nombre “Sensor”, ya que ese es el nombre genérico que utiliza el Manager y que a la larga, podría causar confusión.</para>
			</note>
			<warning>
				<title>Advertencia</title>
				<para>El sistema le pedirá que verifique que el nombre elegido es el correcto, en ese caso, pulse <keycap>Enter</keycap></para>
				<para>Si desea modificarlo inserte la letra <keycap>n</keycap></para>
				<para>El sistema procederá a cambiar el nombre del sensor. Para continuar, y regeresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
			</warning>	
		</section>		
		<section>
			<title>Configurar hora local</title>
			<para>Seleccionar la opción <literal>2) Set local time.</literal></para>
			<para>Insertar fecha y hora de la franja horaria correspondiente al país en el que se encuentre. Esta debería coincidir con la seleccionada en la fase de ajustes básicos durante el proceso de configuración de los sensores IPS. </para>
			<para> El sistema le indica dos formatos posibles para la inserción de la fecha y la hora:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><literal>[HH:mm]</literal> ó <literal>[YYYY/MM/DD]</literal></para>
				</listitem>
				<listitem>
					<para><literal> [YYYY/MM/DD HH:mm]</literal></para>
				</listitem>
			</itemizedlist>
			<para>Pulsar <keycap>Enter</keycap> para continuar con el proceso de registro.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img010.png"/>
			    </imageobject>
			   <caption>
				<para>Registro de los sensores en el Manager: Selección hora local</para>
			</caption>
		    </mediaobject>
		</section>
		<section>
			<title>Introducir la IP del rB Master Manager</title>
			<para>Seleccionar la opción <literal>3) IP adress for rB Master Manager [00.0.000.00].</literal></para>
			<para>Insertar la dirección IP o nombre de dominio del equipo utilizado por el usuario. El sistema realizará una serie de comprobaciones para verificar si es alcanzable. Este proceso puede llevar unos segundos.</para>
			<para>El sistema sincronizará la hora de los equipos y a continuación, reiniciará un par de servicios con el objetivo de finalizar la sincronía horaria.</para>
			<para> ¡Enhorabuena! Su equipo está preparado para realizar el registro de los sensores en el Manager.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img011.png"/>
			    </imageobject>
			   <caption>
				<para>Insertar IP rB Master Manager</para>
			</caption>
		    </mediaobject>
		    <para>Para continuar, y regeresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
		</section>
		<section>
			<title>Registro de los sensores en el Manager</title>
			<para>Este es el último paso que da por finalizado el proceso de instalación y configuración del sensor Gateway desde el asistente de instalación de redBorder.</para>
			<para> A partir de este momento, usted podrá trabajar directamente desde la plataforma redBorder en la que deberá realizar las últimas configuraciones generales para el sensor Gateway, tal y como se verá más adelante. </para>
			<para>En esta aplicación podrá crear informes, visualizar los eventos o configurar las reglas del Manager entre otras acciones. </para>
			<para><emphasis>Finalización del proceso del registro de los sensores en el Manager</emphasis></para>
			<para> Los pasos que se van a seguir para completar el proceso de registro de los sensores en el Manager son los siguientes:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para> Indicar si se desea tener una salida de depuración: el sistema formulará la siguiente pregunta <literal>Would you like to have a debug output?</literal> Seleccionar la opción predeterminada (No) insertando la letra <keycap>N</keycap>.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Insertar password:</emphasis> indicar la clave que se ha introducido en la fase de ajustes básicos para la configuración del Manager.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold"> Sincronización temporal (automático) entre el Manager y los sensores:</emphasis> este proceso puede llevar unos segundos en completarse.</para>
		        </listitem>
		     </orderedlist>
		     <mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img012.png"/>
				</imageobject>
			<caption>
				<para>Finalización del registro de los sensores en el Manager</para>
			</caption>
			</mediaobject>
				<para>Tras la realización de estos pasos, el sistema le avisará con un mensaje de que el sensor ha sido registrado con éxito.</para>
				<para><literal> Sensor registered succesfully with chef server</literal></para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img013.png"/>
			        </imageobject>
			    <caption>
					<para>Registro del sensor en el servidor</para>
				</caption>
		    </mediaobject>
			<warning>
				<title>Advertencia</title>
				<para>No cambiar el nombre del sensor o <emphasis>hostname</emphasis> una vez que ha sido registrado. Si desea realizar cambios, será necesario deshacer todo el proceso de registro y comenzarlo de nuevo.</para>
			</warning>
			<para>Para continuar y regresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
			<para>En él menú de registro de los sensores en el Manager redBorder puede comprobar que el sensor ha sido registrado con éxito:<literal>(Registered).</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img014.png"/>
			    </imageobject>
			    <caption>
					<para>Registro del sensor realizado con éxito</para>
				</caption>
		    </mediaobject>
		    <para> Para salir del asistente de registro de los sensores en el Manager, seleccione la opción <literal>quit</literal> introduciendo la letra <keycap>q.</keycap></para>				
		</section>
	</section>
	<section>
		<title>Configuración  de parámetros generales del sensor desde la plataforma web redBorder</title>
		<para>¡Felicidades! ha realizado la configuración y el registro de los sensores Gateway en el Manager con éxito. El último paso consiste en determinar los parámetros generales de los sensores desde la plataforma web de redBorder a la que puede acceder insertando la IP de gestión asignada al Manager en la barra de direcciones de su navegador.</para>
		<para><screen>https://direccion-IP-manager</screen></para>
		<note>
		<title>Nota</title>
		<para>Es posible iniciar sesión en la plataforma usando la cuenta definida por defecto: <emphasis role="bold">admin o admin@redborder.net</emphasis> y con la contraseña que haya insertado en el proceso de instalación del Manager.</para>
		</note>
		<warning>
			<title>Advertencia</title>
			<para>La web de gestión no funcionará si se intenta acceder a ella mediante web no cifrada.</para>
		</warning>
		<para>Para editar los parámetros generales del sensor Gateway el usuario debe dirigirse a la sección <literal>Sensors</literal> situada en el lado derecho del menú de cabecera. A continuación deberá seleccionar el sensor que desea editar.</para>
		<para>En la vista árbol, los sensores Gateway vienen acompañados de un icono identificativo. También puede buscar el sensor que desea editar en el listado que se muestra desde <literal>View>Gateway Sensors.</literal></para>
		<para>Para comenzar la edición de los parámetros generales del sensor hacer clic en el icono "Editar":</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img015.png"/>
			 </imageobject>
			 <caption>
				<para>Editar sensor Gateway</para>
			</caption>
		</mediaobject>
		<para>En la interfaz de edición del sensor introduciremos la siguiente información:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Especificar la IP del servidor de correo en <literal>Gateway Settings>Relay Host.</literal></para>
			</listitem>
			<listitem>
				<para>Definir el tamaño máximo de los mensajes en <literal>Gateway Settings>Message Size Limit.</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img016.png"/>
				</imageobject>
				<caption>
					<para>Gateway Settings: Especificar IP del servidor de correo y tamaño de los mensajes</para>
				</caption>
			</mediaobject>
			</listitem>
			<listitem>
				<para>Definir el/los dominios que van a estar gestionados por el sensor: en el apartado <literal>Relay Domains</literal> hacer clic en la pestaña <literal>+Add Domains</literal> e introducir el dominio que se desea asociar, hacer clic en <keycap>Update</keycap> para guardar la información. Repetir esta operación tantas veces como sea necesaria.</para>
				<mediaobject>
				<imageobject>
					<imagedata scalefit="60" align="center" fileref="images/ch05_img017.png"/>
				</imageobject>
				<caption>
					<para>Gateway Settings: Especificar IP del servidor de correo y tamaño de los mensajes</para>
				</caption>
			</mediaobject>
			</listitem>
		</itemizedlist>	
		<para>Para guardar la configuración del sensor, hacer clic en el botón <keycap>Update.</keycap></para>
	</section>  	
</chapter>
