<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "manual.ent">
<!ENTITY PRODUCT "Documentation">
<!ENTITY BOOKID "manual">
<!ENTITY YEAR "2016">
<!ENTITY HOLDER "Eneo Tecnología S.L. |">
]>
<chapter>
	<title>Sensores Mail Gateway</title>
	<section>
		<title>Instalación y registro de los sensores Mail Gateway</title>
		<para>El proceso de instalación del sensor  Mail Gateway consta fundamentalmente de tres pasos: configuración de red, registro del sensor en el Manager y configuración de los parámetros generales del sensor en la plataforma redBorder. Para ello, deberá disponer del asistente de instalación (imagen ISO) obtenido mediante descarga o a través del DVD facilitado por redBorder. </para>
		<para>Al poner en funcionamiento el asistente de instalación, visualizaremos el menú principal en el que encontrará la opción <literal>Install Sensor Gateway</literal>:</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img001.png"/>
			</imageobject>
				<textobject>
				<phrase>Asistente de instalación redBorder: Instalar sensor Mail Gateway</phrase>
			</textobject>
			<caption>
				<para>Asistente de instalación redBorder: Instalar sensor Mail Gateway</para>
			</caption>
		</mediaobject>
		<para>A continuación el usuario deberá introducir su nombre de usuario y contraseña 
		<footnote><para>El nombre de usuario y contraseña que se deben introducir en este paso corresponden con los que se han indicado en el 
		proceso de instalación del Manager y serán los que le sirvan para acceder a la plataforma web redBorder.</para></footnote>, así como ejecutar el comando rb_sysconf:</para>
		<itemizedlist mark="bullet">
			<listitem>
				<para>Login</para>
			</listitem>
			<listitem>
				<para>Password</para>
			</listitem>
			<listitem>
				<para>Comando rb_sysconf</para>
			</listitem>
		</itemizedlist>	
		<para>Este proceso es idéntico al expuesto en la <emphasis role="bold">Finalización del proceso de instalación del asistente para la configuración del Manager.</emphasis></para>
		<section>
			<title>Configuración de red de los sensores Gateway</title>
			<para>Una vez ha ejecutado el comando <literal>rb_sysconf</literal> accederá al <emphasis role="bold"> Menú de Configuración redBorder.</emphasis></para>
			<para>Este menú consta de 4 opciones:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para><literal>System Configuration:</literal>desde esta opción se pueden definir y modificar una serie de ajustes básicos del sistema como el nombre, hora, tipo de teclado, etc.</para>
				</listitem>
				<listitem>
					<para><literal>Network Configuration:</literal> esta es la opción desde la cual se realizan todas las configuraciones de red para la correcta implantación de la solución.</para>
				</listitem>
				<listitem>
					<para><literal>Passwords:</literal> acceda a esta opción si desea modificar sus contraseñas.</para>
				</listitem>
				<listitem>
					<para><literal>Backup System:</literal> permite realizar una copia de seguridad de la configuración.</para>
				</listitem>
				<listitem>
					<para><literal>quit:</literal> Salir.</para>
				</listitem>
			</orderedlist>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img002.png"/>
				</imageobject>
				<textobject>
					<phrase>Menú de configuración redBorder</phrase>
				</textobject>
				<caption>
					<para>Menú de configuración redBorder</para>
				</caption>
			</mediaobject>
			<note>
				<title>Nota</title>
				<para>Recuerde: selección de opciones predeterminadas: <keycap>Enter</keycap></para>
			</note>
			<section>
				<title>Pasos para la configuración de red de los sensores Mail Gateway</title>
				<para>Como se ha comentado al inicio del capítulo, el primer paso para comenzar la configuración de los sensores Mail Gateway es el establecimiento de los parámetros de red o puesta en red de los sensores.</para>	
				<para>Para comenzar le proceso seleccionar la opción <literal>2) Network Configuration</literal> del menú de Configuración redBorder.</para>
				<para>Estos son los pasos que hay que seguir para realizar la instalación de los sensores Mail Gateway:</para>
				<orderedlist numeration="arabic">
					<listitem>
						<para>Configuración de la red de gestión:</para>
						<para>Creación del bond y asignación de interfaz de gestión.</para>
					</listitem>
					<listitem>
						<para>Configuración DNS y dominio</para>
					</listitem>
				</orderedlist>
				<note>
					<title>Nota</title>
					<para>El orden que se siga en los pasos que comprenden la configuración de la red de gestión es indiferente. El orden indicado en este manual de instalación es el que se considera más óptimo.</para>
					<para>Hasta que no se haya realizado esta configuración, no se podrá proceder al registro de los sensores en el Manager.</para>
				</note>
				<warning>
					<title>Advertencia</title>
					<para>Para la instalación y registro de los sensores Mail Gateway es necesario disponer de tan solo un bond.</para>
					<para>En caso de que el sistema se instale en un equipo real que disponga de más de una tarjeta de red, el usuario deberá elegir cuál será el bond de gestión.</para>
				</warning>
				<section>
					<title>Creación de un nuevo bond y asignación de puertos</title>
					<para>Una vez que hemos accedido al <literal>redBorder Network configuration menu</literal> seleccionamos la opción <literal>1) Management Network Configuration</literal> desde la cual podremos realizar la creación de un bond para la instalación del sensor.</para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img003.png"/>
						</imageobject>
						<caption>
							<para>redBorder Network Configuration menu: selección de la opción 1) Management Network Configuration para la creación de un bond </para>
						</caption>
					</mediaobject>
					<para>Para ilustrar este proceso crearemos un bonding (bond0) y le asignaremos 2 puertos.</para>
					<para>Seleccione la opción <keycap>n</keycap> que aparece en el submenú lateral derecho de la pantalla.</para>
					<para>Una vez que haya revisado los puertos que se encuentran disponibles, seleccione aquel que desea asignar al bonding, tal y como aparece en el margen inferior de la pantalla anterior.</para>
					<para>Introduzca el número de puerto en la línea <literal>Insert bonding first port [0]:</literal></para>
					<para>El número que aparece entre corchetes <literal>[]</literal> es el que define el sistema por defecto. Para seleccionar este número, pulse <keycap>Enter.</keycap></para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img004.png"/>
						</imageobject>
						<caption>
							<para>Creación de un bond: asignación de puertos</para>
						</caption>
					</mediaobject>
					<para>El puerto seleccionado desaparecerá de la opción de puertos disponibles.</para>
					<important>
						<title>Importante</title>
						<para>El sistema solo permite la creación de un máximo de 4 bonds: (0-3).</para>
					</important>
				</section>
				<section>
					<title>Finalizar el proceso de creación del bonding</title>
					<para>Antes de aplicar cambios y finalizar el proceso de creación del bonding el sistema le mostrará una tabla en la que figuran el nuevo bonding creado (bond0) junto con los puertos que le han sido asignados, la IP y Máscara y la ruta asignadas.</para>	
					<para><emphasis role="bold">Aplicar cambios</emphasis></para>
					<para>Para que las modificaciones realizadas queden guardadas, debe realizar la acción de aplicar cambios, seleccionando la opción <keycap>a.</keycap></para>
					<para>Puede borrar en cualquier momento el/ los bonds creados seleccionado la opción <literal>delete bonding</literal> insertando la letra <keycap>d.</keycap></para>
					<para>Para volver al menú principal de configuración de red, seleccionar la opción <literal>quit</literal> con la letra <keycap>q.</keycap></para>
				</section>
			</section>
			<section>
				<title>Configuración DNS y dominio</title>
				<para>Al salir del <literal>1) Management Network configuration</literal> volvemos a la interfaz del <literal>redBorder Network configuration menu</literal> en el que encontramos la opción de configuración de DNS y dominio. Inicie la configuración seleccionando: <literal>2) DNS and domain settings.</literal></para>
				<para>Para realizar la configuración correctamente, el usuario deberá introducir:</para>
				<itemizedlist mark="bullet">
					<listitem>
						<para>Nombre de Dominio</para>
					</listitem>
					<listitem>
						<para>Dirección DNS primaria</para>
					</listitem>
					<listitem>
						<para>Dirección DNS secundaria (opcional)</para>
					</listitem>
				</itemizedlist>
				<para>Una vez introducida esta información, el sistema avisará de que se ha aplicado esta configuración de manera correcta.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img005.png"/>
					</imageobject>
					<caption>
						<para>Configuración DNS y dominio</para>
					</caption>
				</mediaobject>
				<para>Para finalizar el proceso, es necesario aplicar cambios: seleccionar la opción <literal>apply</literal> insertando la letra <keycap>a</keycap> en el menú principal de configuración de red.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img006.png"/>
					</imageobject>
					<caption>
						<para>Configuración DNS y dominio</para>
					</caption>
				</mediaobject>
			</section>
		</section>		
		<section>
			<title>Registro de los sensores en el Manager</title>
			<para>Para finalizar el proceso de instalación de los sensores Mail Gateway, el último paso que debe llevarse a cabo es el <emphasis role="bold">Registro de los sensores en el Manager.</emphasis></para>
			<para>Hasta que no se haya completado el registro, se visualizará un mensaje en el que se indica que los sensores aún no han sido registrados en el Manager. </para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img007.png"/>
				</imageobject>
				<caption>
					<para>Inicio del regsitro de los sensores en el Manager</para>
				</caption>
			</mediaobject>	
			<para>En el menú de registro de los sensores en el Manager encontramos las siguientes opciones:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para><literal>Hostname [rbsensor]:</literal> asignar un nombre al sensor.</para>
				</listitem>
				<listitem>
					<para><literal>Set local time:</literal> configurar hora local.</para>
				</listitem>
				<listitem>
					<para><literal>IP adress for rB Master Manager [127.0.0.1]:</literal> introducir la IP del Manager.</para>
				</listitem>
				<listitem>
					<para><literal>Register rB Sensor/Manager:</literal> registro de los sensores en el manager Sensor/Manager. Hasta que no se haya completado el proceso de registro el usuario visualizará el siguiente mensaje rotulado en rojo: <literal>(not registered yet)</literal></para>
				</listitem>
			</orderedlist>
			<section>
				<title>Asignar nombre al sensor (Hostname)</title>
				<para> Seleccionar la opción <literal>Hostname [rbsensor]</literal> del menú de registro de los sensores en el Manager insertando el número <keycap>1.</keycap></para>
				<para> A continuación, en la línea <literal>Insert Hostname [rbsensor]:</literal> escribir el nombre que se desea dar al sensor que se va a registrar en el Manager. A partir de este momento, este es el nombre que visualizará en la web cuando acceda al listado de sensores IPS.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img009.png"/>
					</imageobject>
				<caption>
					<para>Asignar nombre al sensor</para>
				</caption>
				</mediaobject>
				<note>
					<title>Nota</title>
					<para>Recuerde introducir un nombre coherente para el sensor. Evite utilizar el nombre “Sensor”, ya que ese es el nombre genérico que utiliza el Manager y que a la larga, podría causar confusión.</para>
				</note>
				<warning>
					<title>Advertencia</title>
					<para>El sistema le pedirá que verifique que el nombre elegido es el correcto, en ese caso, pulse <keycap>Enter</keycap></para>
					<para>Si desea modificarlo inserte la letra <keycap>n</keycap></para>
					<para>El sistema procederá a cambiar el nombre del sensor. Para continuar, y regeresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
				</warning>	
			</section>		
			<section>
				<title>Configurar hora local</title>
				<para>Seleccionar la opción <literal>2) Set local time.</literal></para>
				<para>Insertar fecha y hora de la franja horaria correspondiente al país en el que se encuentre. Esta debería coincidir con la seleccionada en la fase de ajustes básicos durante el proceso de configuración de los sensores IPS. </para>
				<para> El sistema le indica dos formatos posibles para la inserción de la fecha y la hora:</para>
				<itemizedlist mark="bullet">
					<listitem>
						<para><literal>[HH:mm]</literal> ó <literal>[YYYY/MM/DD]</literal></para>
					</listitem>
					<listitem>
						<para><literal> [YYYY/MM/DD HH:mm]</literal></para>
					</listitem>
				</itemizedlist>
				<para>Pulsar <keycap>Enter</keycap> para continuar con el proceso de registro.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img010.png"/>
					</imageobject>
				<caption>
					<para>Registro de los sensores en el Manager: Selección hora local</para>
				</caption>
				</mediaobject>
			</section>
			<section>
				<title>Introducir la IP del rB Master Manager</title>
				<para>Seleccionar la opción <literal>3) IP adress for rB Master Manager [00.0.000.00].</literal></para>
				<para>Insertar la dirección IP o nombre de dominio del equipo utilizado por el usuario. El sistema realizará una serie de comprobaciones para verificar si es alcanzable. Este proceso puede llevar unos segundos.</para>
				<para>El sistema sincronizará la hora de los equipos y a continuación, reiniciará un par de servicios con el objetivo de finalizar la sincronía horaria.</para>
				<para> ¡Enhorabuena! Su equipo está preparado para realizar el registro de los sensores en el Manager.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img011.png"/>
					</imageobject>
					<caption>
						<para>Insertar IP rB Master Manager</para>
					</caption>
				</mediaobject>
				<para>Para continuar, y regresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
			</section>
			<section>
				<title>Registro de los sensores en el Manager</title>
				<para>Este es el último paso que da por finalizado el proceso de instalación y configuración del sensor Mail Gateway desde el asistente de instalación de redBorder.</para>
				<para> A partir de este momento, usted podrá trabajar directamente desde la plataforma redBorder en la que deberá realizar las últimas configuraciones generales para el sensor Mail Gateway, tal y como se verá más adelante. </para>
			<para>En esta aplicación podrá crear informes, visualizar los eventos o configurar las reglas del Manager entre otras acciones. </para>
			<para><emphasis>Finalización del proceso del registro de los sensores en el Manager</emphasis></para>
			<para> Los pasos que se van a seguir para completar el proceso de registro de los sensores en el Manager son los siguientes:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para> Indicar si se desea tener una salida de depuración: el sistema formulará la siguiente pregunta <literal>Would you like to have a debug output?</literal> 
					Seleccionar la opción predeterminada (No) insertando la letra <keycap>N</keycap>.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Insertar password:</emphasis> indicar la clave que se ha introducido en la fase de ajustes básicos para la configuración del Manager.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold"> Sincronización temporal (automático) entre el Manager y los sensores:</emphasis> este proceso puede llevar unos segundos en completarse.</para>
		        </listitem>
		     </orderedlist>
		     <mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img012.png"/>
				</imageobject>
			<caption>
				<para>Finalización del registro de los sensores en el Manager</para>
			</caption>
			</mediaobject>
				<para>Tras la realización de estos pasos, el sistema le avisará con un mensaje de que el sensor ha sido registrado con éxito.</para>
				<para><literal> Sensor registered succesfully with chef server</literal></para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img013.png"/>
			        </imageobject>
			    <caption>
					<para>Registro del sensor en el servidor</para>
				</caption>
		    </mediaobject>
			<warning>
				<title>Advertencia</title>
				<para>No cambiar el nombre del sensor o <emphasis>hostname</emphasis> una vez que ha sido registrado. Si desea realizar cambios, será necesario deshacer todo el proceso de registro y comenzarlo de nuevo.</para>
			</warning>
			<para>Para continuar y regresar al menú de configuración del sistema redBorder, pulse cualquier tecla tal y como se indica <literal>Press a key to continue...</literal></para>
			<para>En él menú de registro de los sensores en el Manager redBorder puede comprobar que el sensor ha sido registrado con éxito:<literal>(Registered).</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img014.png"/>
			    </imageobject>
			    <caption>
					<para>Registro del sensor realizado con éxito</para>
				</caption>
				</mediaobject>
				<para> Para salir del asistente de registro de los sensores en el Manager, seleccione la opción <literal>quit</literal> introduciendo la letra <keycap>q.</keycap></para>				
			</section>
		</section>
	</section>
	<section>
		<title>Edición y configuración de los sensores Mail Gateway</title>
		<para> Para realizar la configuración de los sensores Mail Gateway es necesario acceder a la plataforma web de redBorder insertando la IP de gestión asignada al Manager en la barra de direcciones de su navegador.</para>
		<para><screen>https://direccion-IP-manager</screen></para>
		<note>
		<title>Nota</title>
		<para>Es posible iniciar sesión en la plataforma usando la cuenta definida por defecto: <emphasis role="bold">admin o admin@redborder.net</emphasis>
		 y con la contraseña que haya insertado en el proceso de instalación del Manager.</para>
		</note>
		<warning>
			<title>Advertencia</title>
			<para>La web de gestión no funcionará si se intenta acceder a ella mediante web no cifrada.</para>
		</warning>
		<para>La configuración de los sensores Mail Gateway se puede realizar de dos maneras: </para>
		<orderedlist numeration="arabic">
			<listitem>
				<para><emphasis role="bold">Configuración general de todos los sensores Mail Gateway:</emphasis> Tools->Malware Settings-> Mail Gateway.</para>
			</listitem>
			<listitem>
				<para><emphasis role="bold">Configuración particular de cada uno de los sensores Mail Gateway:</emphasis> Sensors-> icono "Editar" de cada uno de los sensores. </para>
			</listitem>
		</orderedlist>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="150" fileref="images/ch05_img018.png"/>
			 </imageobject>
			 <caption>
				<para>Configuración general de los sensores Mail Gateway</para>
			</caption>
		</mediaobject>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img015.png"/>
			 </imageobject>
			 <caption>
				<para>Editar sensor Mail Gateway</para>
			</caption>
		</mediaobject>
		<para>A continuación, se explican cada una de las pantallas de configuración, así como los parámetros que se pueden modificar para la detección de Malware en su red.</para>
		<section>
			<title>General Settings: Configuración general de los sensores Mail Gateway</title>
			<para>Desde la interfaz <emphasis role="bold">Tools->Malware Settings</emphasis> el usuario puede realizar la configuración general que va a aplicar en todos los sensores registrados.
			Recuerde que este nivel actúa como raíz, de manera que aquellos sensores que estén por debajo de él, heredarán la configuración que se haya definido en esta interfaz.</para>
			<note>
				<title>Nota</title>
				<para>Es posible sobreescribir la configuración general de los sensores Mail Gateway a nivel individual a través de su edición en la sección <literal>Sensors</literal>
				seleccionando el sensor a editar en el árbol o en el listado que aparece en Sensors->View->Gateway Sensors.</para>
			</note>
			<para>Estos son los apartados que el usuario deberá editar para la configuración a nivel root de los sensores Mail Gateway:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para>General</para>
				</listitem>
				<listitem>
					<para>Mail Gateway</para>
				</listitem>
				<listitem>
					<para>Blacklist</para>
				</listitem>
				<listitem>
					<para>Whitelist</para>
				</listitem>
			</itemizedlist>
		</section>
		<section>
			<title>Sensors: configuración individual de los sensores Mail Gateway</title>
			<para>Para editar la configuración de cualquiera de los sensores Mail Gateway a nivel individual
			el usuario debe dirigirse a la sección <literal>Sensors</literal> situada en el lado derecho del menú de cabecera. 
			A continuación, deberá seleccionar el sensor que desea editar.</para>
			<para>En la vista árbol, los sensores Mail Gateway vienen acompañados de un icono identificativo. También puede buscar el sensor en el listado que se muestra desde 
			<literal>View->Gateway Sensors.</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img015b.png"/>
				</imageobject>
				<caption>
					<para>Sensors: vías para la edición de un sensor</para>
				</caption>
			</mediaobject>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img015c.png"/>
				</imageobject>
				<caption>
					<para>Listado de sensores Mail Gateway: Sensors->View->Gateway Sensors</para>
				</caption>
			</mediaobject>
			<para>Dentro del menú que se despliega encontramos las siguientes opciones:</para>
			<itemizedlist mark="circle">
				<listitem>
					<para><emphasis role="bold">Edit:</emphasis> permite la edición de la configuración de un sensor a nivel individual.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Monitors:</emphasis> </para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Quarantine:</emphasis> listado de los correos que se encuentran en cuarentena.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Filter Policies:</emphasis> configuración y asignación de Filter Policies para cada sensor.</para>
				</listitem>
			</itemizedlist>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img015.png"/>
				</imageobject>
				<caption>
					<para>Editar sensor Mail Gateway</para>
				</caption>
			</mediaobject>
			<para>Para comenzar la edición de los parámetros del sensor seleccionar <literal>Edit.</literal></para>	
			<para>En la interfaz de edición del sensor se introducirá la siguiente información. Para guardar la configuración del sensor, hacer clic en el botón <keycap>Update.</keycap></para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><emphasis role="bold">General:</emphasis></para>
					<para>-Name</para>
					<para>-IP</para>
					<para>-Version</para>
					<para>-Description</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Gateway Settings:</emphasis></para>
					<para>-Relay Host</para>
					<para>-Message Size Limit</para>
					<para>-Max Parallel Process</para>
					<para>-API timeout</para>
					<para>-Email detained timeout</para>
					<para>-Quarantine timeout</para>
					<para>-Cache sync</para>
					<para>-Maximum number of stored log files</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Relay Domains</emphasis></para>
					<mediaobject>
						<imageobject>
							<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img019.png"/>
						</imageobject>
						<caption>
							<para>Editar Mail Gateway</para>
						</caption>
					</mediaobject>
				</listitem>
			</itemizedlist>	
			<note>
				<title>Nota</title>
				<para>Los campos nombre, IP y versión son no editables, ya que esta información se introduce en el proceso de configuración y registro del sensor.</para>
			</note>
			<section>
				<title>Gateway Settings</title>
				<para>En este apartado el usuario puede definir el comportamiento del sensor en base a los valores que introduzca en cada uno de los campos que se muestran en él.</para>
				<itemizedlist mark="circle">
					<listitem>
						<para><emphasis role="bold">Relay Host:</emphasis> Especificar la IP del servidor de correo final.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Message Size Limit:</emphasis> Definir el tamaño máximo de los mensajes que se pueden recibir.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Max Paralell Process:</emphasis> Indicar el número máximo de procesos en paralelo que trata el Mail Gateway.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">API timeout (seconds):</emphasis> Definir el tiempo máximo de espera para la obtenicón de un score válido por parte de la caché remota.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Email detained timeout (seconds):</emphasis> En este campo se indica el tiempo máximo de espera para la
						obtención de un score válido por parte de la caché remota. Superado este tiempo el fichero se dejará pasar.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Quarantine timeout (days):</emphasis> Configurar los días que han de pasar desde que un fichero identificado como Malware es bloqueado y retenido hasta que se
						define una acción para gestionarlo. Si no se realiza ninguna acción o se supera el tiempo indicado el fichero es descartado. </para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Cache Sync (hours) (minutes):</emphasis> Indicar el tiempo máximo que debe pasar para la sincronización de la caché local y remota. 
						Valor en horas y en minutos. </para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Maximum number of stored log files:</emphasis> Delimitar el tiempo máximo que el fichero permancerá almacenado en el histórico de correos. </para>
					</listitem>
				</itemizedlist>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img020.png"/>
					</imageobject>
					<caption>
						<para>Gateway Settings</para>
					</caption>
				</mediaobject>
			</section>
			<section>
				<title>Relay Domains</title>
				<para>En este apartado el usuario debe definir qué dominio o dominios son los que van a estar gestionados por el sensor.</para>
				<para>Aquí se visualiza un listado de los dominios que ya han sido agregados. El usuario puede eliminar en cualquier momento aquellos dominios en desuso o que 
				considere que no deben ser gestionados por el sensor.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img021.png"/>
					</imageobject>
					<caption>
						<para>Listado de Relay Domains</para>
					</caption>
				</mediaobject>
				<para>Para añadir un nuevo dominio basta con hacer clic en la en la pestaña <literal>+Add Domains</literal> e introducir el dominio que se desea asociar, hacer clic en 
				<keycap>Update</keycap> para guardar la información.</para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="350" fileref="images/ch05_img022.png"/>
					</imageobject>
					<caption>
						<para>Añadir nuevo Relay Domain</para>
					</caption>
				</mediaobject>
				<warning>
					<title>Advertencia</title>
					<para>Una vez finalizada la edición del sensor Mail Gateway hacer clic en <literal>Update</literal> para aplicar los cambios realizados.</para>
				</warning>
			</section>
		</section> 
		<section>
			<title>Monitors</title>
			<note>
				<title>Nota</title>
				<para>Esta opción solo se encuentra disponible en el menú desplegado por el icono "Editar" a nivel de sensor.</para>
			</note>
			<para>Al hacer clic sobre icono del icono "Editar" sensor, aparece la opción <literal>Monitor</literal>.
			 A continuación, accederemos a una pantalla en la que se visualiza un listado con las métricas de monitorización que queremos aplicarle al sensor.</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="150" fileref="images/ch05_img033.png"/>
				</imageobject>
				<caption>
					<para>Icono editar->Monitors</para>
				</caption>
			</mediaobject>
			<para>Estas son las acciones disponible para el control del estado del sensor: </para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><emphasis role="bold">Restaurar predeterminado:</emphasis> aplica las métricas predeterminadas que se incluyen en el momento de creación de los sensores.</para>					
				</listitem>
				<listitem>
					<para><emphasis role="bold">Añadir monitor:</emphasis> muestra las métricas que se encuentran disponibles para su aplicación. (<literal>+Add Monitor</literal>)</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Eliminar monitor:</emphasis> elimina la métrica aplicada.</para>
				</listitem>
			</itemizedlist>	
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img034.png"/>
				</imageobject>
				<caption>
					<para> Interfaz de métricas de monitorización del sensor: Monitors</para>
				</caption>	
			</mediaobject>	
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="350" fileref="images/ch05_img035.png"/>
				</imageobject>
				<caption>
					<para>Añadir monitor</para>
				</caption>	
			</mediaobject>	
		</section>
		<section>
			<title>Quarantine</title>
			<para>Existen dos maneras de llegar al listado de correos puestos en cuarentena:</para>
			<orderedlist numeration="arabic">
				<listitem>
					<para><emphasis role="bold">Total de correos en cuarentena para todos los sensores Mail Gateway registrados:</emphasis> Sensors->Options->Mail Quarantine</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Correos en cuarentena para un sensor concreto:</emphasis> Sensors-> icono "Editar" de cada uno de los sensores->Quarantine</para>
				</listitem>
			</orderedlist>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img027.png"/>
				</imageobject>
				<caption>
					<para>Quarantine</para>
				</caption>
			</mediaobject>
			<para>En ambos casos se accede a una interfaz en la que se muestra un listado de todos los correos que han sido puestos en cuarentena y que muestra la siguiente información: </para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><emphasis role="bold">Timestamp:</emphasis> fecha y hora de la recepción.</para>
				</listitem>
				<listitem>
					<para>Sensor por el que ha pasado el correo.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Email sender:</emphasis> email del emisor.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Email Destinations:</emphasis> email del receptor.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">URLs:</emphasis> número de URLs incluidas en el correo.</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Files:</emphasis> número de archivos incluidos en el correo. </para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Email ID:</emphasis> número de identificación del email. </para>
				</listitem>
			</itemizedlist>
			<para><emphasis role="bold">Liberar email (Free email):</emphasis> en cualquier momento el usuario puede liberar de la cuarentena aquellos correos que considere que ya han sido analizados 
			y que no representan un peligro. Para ello, hacer clic en el siguiente icono:</para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="50" fileref="images/ch05_img028.png"/>
				</imageobject>
				<caption>
					<para>Gateway Settings</para>
				</caption>
			</mediaobject>
			<para><emphasis role="bold">Eliminar email (Remove email): </emphasis> hacer clic en el icono "Eliminar".</para>
		</section> 
		<section>
			<title>Filter Policies: sensores Mail Gateway</title>
			<para>Para acceder a la creación o edición de las Filter Policies el usuario tiene dos vías diferentes: </para>
			<orderedlist numeration="arabic">
				<listitem>
					<para><emphasis role="bold">Total de Filter Policies creadas para el sensor root:</emphasis> Sensors->Options->Filter Policies</para>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Filter Policies para un sensor concreto:</emphasis> Sensors-> icono "Editar" de cada uno de los sensores->Filter Policies</para>
				</listitem>
			</orderedlist>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img029.png"/>
				</imageobject>
				<caption>
					<para>Listado de Filter Policies para el sensor root</para>
				</caption>
			</mediaobject>
			<para>En ambos casos el usuario accede a una interfaz en la que visualiza un listado con todas las Filter Policies que han sido creadas para ese sensor. La política que se encuentra activa
			(asignada) aparecerá sombreada en color verde.</para>
			<para>Para asignar una política a un sensor hacer clic en el botón <literal>Assign.</literal> Para aplicar la política asignada al sensor seleccionar la opción <literal>Apply.</literal></para>
			<para>Para desasignar una política seleccionar la opción <literal>Clear.</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img030.png"/>
				</imageobject>
				<caption>
					<para>Listado de Filter Policies para un sensor Mail Gateway</para>
				</caption>
			</mediaobject>
			<section>
				<title>Creación de una nueva Filter Policy</title>
				<para>Una vez que se ha accedido a la interfaz de Filter Policies para crear una nueva política basta con seleccionar la opción <literal>+New Policy.</literal>
				El usuario deberá indicar al menos un nombre para la nueva política y de modo opcional, insertar una descripción.</para>
				<para>A continuación deberá indicar las reglas que se incluyen en esta política. El procedimiento variará según se quiera aplicar la política a nivel de Hash, URL o IP.</para>
				<para>Para definir las reglas de la política basta con hacer clic sobre la política que se desea modificar o bien mediante el icono "Editar". </para>
				<mediaobject>
					<imageobject>
						<imagedata scalefit="1" align="center" width="350" fileref="images/ch05_img031.png"/>
					</imageobject>
					<caption>
						<para>Crear una nueva Filter Policy</para>
					</caption>
				</mediaobject>
				<para>La interfaz de edición de las Filter Policies consta de dos apartados: Edit Filter Policy y Threshold Configuration. En ambos apartados el usuario puede editar la siguiente información:</para>
				<itemizedlist mark="bullet">
					<listitem>
						<para><emphasis role="bold">Name</emphasis></para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Description</emphasis></para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Caché query method:</emphasis> el usuario debe indicar el tipo de consultas que desea que se realicen a la caché.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Apply Filter Policy for:</emphasis> seleccionar el tipo de objeto a analizar.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Score to consider element as Malware:</emphasis> indicar el score a partir del cual un objeto es considerado Malware.</para>
					</listitem>
					<listitem>
						<para><emphasis role="bold">Drop files that exceed this size (MB)</emphasis> (este campo solo se encuentra habilitado en el caso de que se haya seleccionado aplicar la política para Hash):
					 indicar el tamaño máximo de los ficheros a partir del cual serán bloqueados por el sistema.</para>
					</listitem>
				</itemizedlist>
				<note>
					<title>Configuración recomendada</title>
					<para><emphasis role="bold">Caché query method:</emphasis> Local+API</para>
					<para><emphasis role="bold">Apply Filter Policy for:</emphasis> se recomienda seleccionar los tres tipos de objetos (Hash, URL e IP).</para>
				</note>
				<para><emphasis role="bold">File Rules</emphasis></para>
				<para>En el caso de que se haya activado en el campo <literal>Apply Filter Policy for:</literal> la casilla correspondiente a Hash se desplegará un nuevo apartado en el margen inferior: File Rules.</para>
				<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img032.png"/>
				</imageobject>
				<caption>
					<para>Filter Policies: File Rules</para>
				</caption>
			</mediaobject>
				<para>En este apartado se muestra un listado del tipo de ficheros sobre los que se pueden realizar acciones. Las acciones disponibles son:</para>
				<itemizedlist mark="bullet">
					<listitem>
						<para>Filter</para>
					</listitem>
					<listitem>
						<para>Drop (bloqueo)</para>
					</listitem>
					<listitem>
						<para>Pass</para>
					</listitem>
				</itemizedlist>
				<para>Para aplicar la nueva configuración seleccionar la opción <literal>Save.</literal></para>		
			</section>		
		</section>
	</section>
	<section>
		<title>Eventos Malware (Mail Gateway)</title>
		<para>Para realizar un seguimiento y análisis profundo de los objetos que están interactuando con nuestra red, el usuario puede realizar una serie de acciones
		desde la sección Malware situada en el margen izquierdo del menú de cabecera.</para>
		<note>
			<title>Visualización de los objetos detectados por el sensor Mail Gateway</title>
			<para>Para visualizar los eventos producidos por los objetos detectados por el sensor Mail Gateway el usuario puede seleccionar los atributos correspondientes a Hash, URL e IP
			mediante la opción <literal>+Add Tab.</literal></para>
			<para>De este modo, esos atributos se añadirán a la vista y el usuario podrá realizar diferentes acciones sobre ellos.</para>
		</note>
		<para>Una vez que hemos añadido a la vista los atributos deseados podremos visualizar un resumen con los eventos producidos por ellos. Al hacer clic sobre cualquiera de estos elementos se despliega un submenú desde el 
		cual se pueden realizar acciones de análisis y seguimiento de los objetos.</para>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="150" fileref="images/ch05_img036.png"/>
			</imageobject>
			<caption>
				<para>Submenú atributos en vista de eventos Malware</para>
			</caption>
		</mediaobject>
		<section>
			<title>Outliers</title>
			<para>Activando esta opción se marcarán en la vista las anomalías de los eventos del atributo seleccionado. Esta acción es muy útil para aislar comportamientos anómalos dentro del flujo del tráfico.</para>
			<para>Para conseguir un resultado significativo esta consulta debe realizarse cuando el Manager contenga un histórico de datos de al menos un mes.</para>
		</section>
		<section>
			<title>Filenames (Hash)</title>
			<para>Mediante esta opción el usuario obtiene  a partir de un Hash los sucesivos nombres que ha tenido un fichero. 
			Esto simplifica la identificación de un fichero alq ue se le ha asignado un único Hash aunque este haya tenido diferentes nombres.</para>
			<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="350" fileref="images/ch05_img036b.png"/>
			</imageobject>
			<caption>
				<para>Filenames</para>
			</caption>
		</mediaobject>	
		</section>
		<section>
			<title>Analysis</title>
			<para>Al seleccionar la opción <literal>Analysis</literal> el usuario visualiza un completo resumen sobre el estado del fichero.</para>
			<para>En la pantalla de Analysis se muestra la siguiente información:</para>
			<itemizedlist mark="bullet">
				<listitem>
					<para><emphasis role="bold">Status</emphasis></para>
					<para>En este apartado se muestra el progreso del análisis del fichero y la información correspondiente a los servicios externos de reputación.</para>
					<para>Es posible descargar el fichero que se está analizando mediante la opción <literal>Download File.</literal></para>
					<important>
						<title>Importante</title>
						<para>La opción de descarga del histórico (Download Historical) no aparece de manera inmediata. Se genera en el momento en el que se han obtenido los resultados
						de todos los cargadores.</para>
					</important>
				</listitem>
				<listitem>
					<para><emphasis role="bold">Loaders</emphasis></para>
					<para>En este apartado se muestra con mayor grado de detalle el proceso y resultado del análisis realizado por los diferentes cargadores o servicios de reputación. 
					<footnote><para>En el caso de Cuckoo dependiendo de la cantidad de archivos a analizar puede existir una demora a la hora de reflejar el score. </para></footnote>.</para>
					<para>Es posible realizar la descarga del histórico del fichero en formato JSON.</para>
					<note>
						<title>Nota</title>
						<para>Estos son los valores que pueden aparecer como resultado del análisis realizado por los cargadores:</para>
						<para><emphasis role="bold">-</emphasis>: elemento no analizado.</para>
						<para><emphasis role="bold">Unknown</emphasis>: el elemento ha sido analizado, pero el resultado es desconocido. (Es el equivalente a un score de -1).</para>
					</note>
				</listitem>
			</itemizedlist>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img038.png"/>
				</imageobject>
				<caption>
					<para>Analysis->Status</para>
				</caption>
			</mediaobject>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img039.png"/>
				</imageobject>
				<caption>
					<para>Analysis->Loaders</para>
				</caption>
			</mediaobject>
			<note>
				<title>Nota</title>
				<para>En cualquier momento se puede pasar a la vista de Evolución o Propagación del objeto que se está analizando, gracias a la posibilidad de saltar de una vista a otra mediante
				las opciones que se muestran en el margen superior derecho: <literal>Show Evolution/Show Propagation.</literal></para>
			</note>
		</section>
		<section>
		<title>Evolution</title>
			<para><literal>Evolution</literal> muestra la evolución temporal de los diferentes eventos recogidos por cada uno de los sensores que se encuentran registrados en el Manager. </para>
			<para>En la parte superior de la pantalla encontramos una representación gráfica de esta evolución sobre una línea de tiempo. Dependiendo del volumen de los círculos se habrán registrado
			mayor o menor número de eventos para un periodo de tiempo determinado.</para>
			<para>Es posible visualizar la evolución de un objeto en un tiempo concreo mediante la selección de <literal>Filter Time.</literal></para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img040b.png"/>
				</imageobject>
				<caption>
					<para>Filter Time</para>
				</caption>
			</mediaobject>
			<para>En la parte inferior se ofrece un resumen detallado de cada uno de los eventos por sensor especificando el score asignado para el objeto que se está analizando, el sensor, SRC Address
			DST Address, el email emisor, los emails receptores y el número de eventos generados por ese objeto (en la imagen se trata de eventos registrados para ese Hash/fichero). </para>
			<mediaobject>
				<imageobject>
					<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img040.png"/>
				</imageobject>
				<caption>
					<para>Show evolution</para>
				</caption>
			</mediaobject>	
			<note>
				<title>Nota</title>
				<para>En cualquier momento se puede pasar a la vista de Análisis o propagación del objeto cuya evolución se está analizando, gracias a la posibilidad de saltar de una vista a otra mediante
				las opciones que se muestran en el margen superior derecho: <literal>Show Analysis/Show Propagation.</literal></para>
			</note>
		</section> 
		<section>
		<title>Propagation</title>
		<para>Al seleccionar la opción <literal>Propagation</literal> accedemos a una interfaz en la que se nos muestra de manera gráfica la propagación
		de ese objeto (en la imagen hash o fichero) a través de las IPs o Emails de nuestra organización.</para>
		<para>Haciendo clic en alguno de los nodos que se muestran (IPs/emails de origen y de destino) se visualiza en la parte inferior un resumen de todos los eventos asociados a ese nodo
		en el periodo de tiempo seleccionado. </para>
		<para>Asimismo, colocando el ratón encima de cualquiera de los nodos se destacarán los nodos (IPs/Emails) que hayan interactuado con él.</para>
		<important>
			<title>Importante</title>
			<para>Es posible filtrar un elemento concreto introduciendo sus datos en el buscador que se encuentra en el margen derecho. Al comenzar a escribir los datos se irán
			destacando aquellos nodos coincidentes. </para>
		</important>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img041.png"/>
			</imageobject>
			<caption>
				<para>Propagation</para>
			</caption>
		</mediaobject>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img041b.png"/>
			</imageobject>
			<caption>
				<para>Propagation: eventos de un nodo</para>
			</caption>
		</mediaobject>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img041c.png"/>
			</imageobject>
			<caption>
				<para>Propagation: detalle de interacción entre nodos</para>
			</caption>
		</mediaobject>
		<mediaobject>
			<imageobject>
				<imagedata scalefit="1" align="center" width="450" fileref="images/ch05_img041d.png"/>
			</imageobject>
			<caption>
				<para>Propagation: filtrar información a través del buscador</para>
			</caption>
		</mediaobject>
		<note>
			<title>Nota</title>
			<para>En cualquier momento se puede pasar a la vista de Evolución o Propagación del objeto que se está analizando, gracias a la posibilidad de saltar de una vista a otra mediante
			las opciones que se muestran en el margen superior derecho: <literal>Show Analysis/Show Evolution.</literal></para>
			</note>
		</section>
	</section> 	 	
</chapter>
